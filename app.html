<!--
================================================================================
TaijiFlow AI - Main Application (index.html)
================================================================================

‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏õ‡∏û‡∏•‡∏¥‡πÄ‡∏Ñ‡∏ä‡∏±‡∏ô TaijiFlow AI ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ù‡∏∂‡∏Å‡∏ó‡πà‡∏≤‡∏°‡πâ‡∏ß‡∏ô‡πÑ‡∏´‡∏°

‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å:
  1. HEAD
    - Meta tags ‡πÅ‡∏•‡∏∞ Favicon
    - Stylesheets (TailwindCSS, Google Fonts, Custom CSS)
    - External Scripts (MediaPipe Pose, Camera, Drawing, Gesture)
    - App Modules (JS files with defer)

  2. BODY
    - Privacy Modal: ‡πÅ‡∏à‡πâ‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÇ‡∏´‡∏•‡∏î)
    - Header: ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô
    - Main Card:
      - Top Bar: Dropdowns (Exercise/Level) + Settings (Audio/Language/Theme)
      - Canvas Container: Video + Skeleton + Overlays
      - Control Buttons: Start/Stop Training
      - Instructions (hidden)
    - Hidden Legacy Elements: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö backward compatibility ‡∏Å‡∏±‡∏ö script.js
    - Notification Container: Toast notifications

  3. OVERLAYS (inside Canvas Container)
    - Loading: ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏•‡∏î AI Model
    - Start: ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÅ‡∏™‡∏î‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å)
    - Countdown: 3-2-1 (‡πÅ‡∏™‡∏î‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å)
    - Fullscreen Button: ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ù‡∏∂‡∏Å)
    - Training Controls: Timer + Stop Button ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á (‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ù‡∏∂‡∏Å)

Dependencies:
  - MediaPipe: Pose Detection, Camera Utils, Drawing Utils, Gesture Recognition
  - TailwindCSS: Styling (CDN)
  - Google Fonts: Sarabun
  - Custom: css/styles.css, css/chatbot.css

Related Files:
  - js/script.js: Main controller
  - js/translations.js: i18n strings
  - js/ui_manager.js: UI state management

Version: 0.9.9 (2026-01-17)
================================================================================
-->
<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaijiFlow AI</title>

    <!-- Performance Optimization: Preconnect & Prefetch -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png" />

    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/feedback.css" />

    <!-- MediaPipe -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
      crossorigin="anonymous"
      defer
    ></script>
    <!-- MediaPipe Drawing Utils -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
      defer
    ></script>
    <!-- MediaPipe Pose -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"
      crossorigin="anonymous"
      defer
    ></script>
    <!-- MediaPipe Gesture Recognition -->
    <!-- <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js"
      crossorigin="anonymous"
      defer
    ></script> -->
    <!-- MediaPipe Selfie Segmentation (for Silhouette) -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"
      crossorigin="anonymous"
      defer
    ></script>

    <!-- =========================================================================
        App Modules - ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Dependencies (‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏Å‡πà‡∏≠‡∏ô)
        ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: defer = ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° HTML ‡πÅ‡∏ï‡πà‡∏£‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°
        ========================================================================= -->
    <!-- 1. Core Managers - ‡πÑ‡∏°‡πà‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏≠‡∏∑‡πà‡∏ô -->
    <!-- T-Pose Calibration -->
    <script src="js/core/calibration_manager.js" defer></script>
    <!-- Math Utils -->
    <script src="js/utils/math_utils.js"></script>
    <!-- Time Utils -->
    <script src="js/utils/time_utils.js"></script>
    <!-- Heuristics Engine -->
    <script src="js/core/heuristics_engine.js"></script>
    <!-- Camera Manager -->
    <script src="js/core/camera_manager.js"></script>
    <!-- Performance Monitor -->
    <script src="js/core/performance_monitor.js"></script>
    <!-- Rules Settings UI -->
    <script src="js/ui/rules_config_manager.js" defer></script>
    <!-- ‡∏ß‡∏≤‡∏î Skeleton/Path -->
    <script src="js/display/drawing_manager.js" defer></script>
    <!-- Export JSON/CSV -->
    <script src="js/utils/data_exporter.js" defer></script>
    <!-- ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î TTS -->
    <script src="js/ui/audio_manager.js" defer></script>
    <!-- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô -->
    <script src="js/core/scoring_manager.js" defer></script>
    <!-- Ghost Overlay -->
    <script src="js/display/ghost_manager.js" defer></script>

    <!-- 2. UI/Translation - ‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤ Core Managers -->
    <!-- i18n TH/EN -->
    <script src="js/utils/translations.js" defer></script>
    <!-- ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ UI State -->
    <script src="js/ui/ui_manager.js" defer></script>
    <!-- Score Popup (‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å ui_manager) -->
    <script src="js/ui/score_popup_manager.js" defer></script>
    <!-- Debug Popup -->
    <script src="js/ui/debug_manager.js" defer></script>
    <!-- Lighting Popup -->
    <script src="js/ui/lighting_manager.js" defer></script>
    <!-- Gesture Popup -->
    <script src="js/ui/gesture_manager.js" defer></script>
    <!-- Tutorial Popup -->
    <script src="js/ui/tutorial_manager.js" defer></script>
    <!-- Feedback Popup (includes shared Survey Section) -->
    <script src="js/ui/feedback_manager.js" defer></script>
    <!-- Shortcuts Popup (New) -->
    <script src="js/ui/shortcuts_manager.js" defer></script>
    <!-- Silk Animation -->
    <script src="js/display/silk-animation.js" defer></script>
    <!-- Taiji Wisdom Popup -->
    <script src="js/ui/wisdom_manager.js" defer></script>

    <!-- 3. Utility Modules (Refactored from script.js) -->
    <!-- Session/User ID management -->
    <script src="js/utils/session_manager.js" defer></script>
    <!-- Dynamic Path Generator -->
    <script src="js/utils/path_generator.js" defer></script>

    <!-- 4. Main Controller - ‡∏û‡∏∂‡πà‡∏á‡∏û‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡πâ‡∏≤‡∏á‡∏ö‡∏ô -->
    <!-- Display Options Controller -->
    <script src="js/controllers/display_controller.js" defer></script>
    <!-- WebGL Manager -->
    <script src="js/display/webgl_manager.js"></script>
    <!-- Background Manager (Virtual Backgrounds) -->
    <script src="js/display/background_manager.js"></script>
    <!-- Keyboard Shortcuts Controller -->
    <script src="js/controllers/keyboard_controller.js" defer></script>
    <!-- Entry Point -->
    <script src="js/controllers/script.js" defer></script>

    <!-- MediaPipe Tasks Vision for Gesture Recognition (loaded as module) -->
    <script type="module">
      import {
        GestureRecognizer,
        FilesetResolver,
      } from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.8";
      window.GestureRecognizerClass = GestureRecognizer;
      window.FilesetResolverClass = FilesetResolver;
      window.dispatchEvent(new Event("mediapipe-ready"));
    </script>
  </head>
  <body
    class="flex flex-col items-center justify-center min-h-screen p-2 md:p-4"
  >
    <!-- Floating Help Button (Bottom Right) -->
    <button
      id="tutorial-btn"
      class="fixed bottom-5 right-5 w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 text-white shadow-[0_4px_20px_rgba(139,92,246,0.4)] flex items-center justify-center text-3xl z-50 hover:scale-110 transition-transform border-2 border-white/20"
      title="‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å (H) - Help"
      aria-label="Help and Tutorial"
    >
      ‚ùì
    </button>

    <!-- Mobile Warning Modal (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) -->
    <div
      id="mobile-modal"
      class="fixed inset-0 bg-black bg-opacity-80 z-[110] hidden items-center justify-center p-4"
    >
      <div
        class="bg-gray-800 rounded-xl p-6 max-w-md w-full shadow-2xl border border-blue-500/50"
      >
        <h2
          id="mobile-title"
          class="text-xl font-bold text-blue-400 mb-4 text-center"
        >
          üì± ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        </h2>
        <p id="mobile-desc" class="text-gray-300 text-center mb-4">
          TaijiFlow AI ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ö‡∏ô‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå (PC/Mac) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û AI ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        </p>
        <p id="mobile-issue-title" class="text-gray-400 text-sm mb-2 text-center">
          ‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠:
        </p>
        <ul class="text-gray-300 text-sm space-y-2 mb-6 ml-4 list-disc pl-2">
          <li id="mobile-issue1">
            <span>‡∏Ñ‡∏ß‡∏£‡∏ß‡∏≤‡∏á‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡πà‡∏á (‡πÉ‡∏ä‡πâ‡∏Ç‡∏≤‡∏ï‡∏±‡πâ‡∏á)</span>
          </li>
          <li id="mobile-issue2">
            <span>‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2-3 ‡πÄ‡∏°‡∏ï‡∏£ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß</span>
          </li>
          <li id="mobile-issue3">
            <span>‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ä‡πâ‡∏≤‡∏•‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (Lite Mode)</span>
          </li>
        </ul>
        <div class="flex gap-3">
          <a
            id="mobile-back-btn"
            href="index.html"
            class="flex-1 py-3 bg-gray-700 hover:bg-gray-600 text-gray-300 font-medium rounded-lg transition-colors text-center border border-gray-600"
          >
            ‡πÑ‡∏ß‡πâ‡∏ß‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏á
          </a>
          <button
            id="mobile-continue-btn"
            class="flex-1 py-3 bg-blue-600 hover:bg-blue-700 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-blue-500/30 text-white font-semibold rounded-lg transition-all duration-200"
          >
            ‡∏ó‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
          </button>
        </div>
      </div>
    </div>

    <!-- Privacy Popup Modal (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤) -->
    <div
      id="privacy-modal"
      class="fixed inset-0 bg-black bg-opacity-70 z-[100] flex items-center justify-center p-4"
    >
      <div
        class="bg-gray-800 rounded-xl p-6 max-w-md w-full shadow-2xl border border-purple-500/30"
      >
        <!-- Main Title -->
        <h1
          id="modal-main-title"
          data-i18n="modal_main_title"
          class="text-2xl font-bold text-white mb-5 text-center"
        >
          ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
        </h1>

        <h2
          id="privacy-title"
          class="text-xl font-bold text-purple-400 mb-4 text-center"
        >
          üîí ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
        </h2>
        <ul class="text-gray-300 text-sm space-y-3 mb-4">
          <li id="privacy-item1" class="flex items-start gap-2">
            <span class="text-green-400">‚úì</span>
            <span>‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span>
          </li>
          <li id="privacy-item2" class="flex items-start gap-2">
            <span class="text-green-400">‚úì</span>
            <span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏ô‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</span>
          </li>
          <li id="privacy-item3" class="flex items-start gap-2">
            <span class="text-blue-400">‚Ñπ</span>
            <span>Chatbot ‡πÉ‡∏ä‡πâ Gemini API (‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ Google)</span>
          </li>
        </ul>

        <!-- Divider -->
        <div class="border-t border-gray-600 my-4"></div>

        <!-- Warning Section -->
        <h3
          id="warning-title"
          class="text-lg font-bold text-amber-400 mb-3 text-center"
        >
          ‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á
        </h3>
        <ul class="text-gray-300 text-sm space-y-3 mb-6">
          <li id="warning-item1" class="flex items-start gap-2">
            <span class="text-red-400">üõë</span>
            <span
              ><strong>Limitation:</strong> AI ‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ù‡∏∂‡∏Å
              ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á</span
            >
          </li>
          <li id="warning-item2" class="flex items-start gap-2">
            <span class="text-red-400">üõë</span>
            <span
              ><strong>Health:</strong> ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢ ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏õ‡∏Å‡∏ï‡∏¥
              ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏ù‡∏∂‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</span
            >
          </li>
          <li id="warning-item3" class="flex items-start gap-2">
            <span class="text-red-400">üõë</span>
            <span
              ><strong>Disclaimer:</strong> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û
              ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ</span
            >
          </li>
        </ul>

        <!-- Buttons: Decline and Accept -->
        <div class="flex gap-3">
          <button
            id="privacy-decline-btn"
            data-i18n="privacy_decline"
            class="flex-1 py-3 bg-gray-600 hover:bg-gray-700 text-gray-300 font-semibold rounded-lg transition-colors"
            onclick="window.location.href = 'index.html'"
          >
            ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
          </button>
          <button
            id="privacy-accept-btn"
            data-i18n="privacy_accept"
            class="flex-1 py-3 bg-purple-600 hover:bg-purple-700 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-purple-500/30 text-white font-semibold rounded-lg transition-all duration-200"
          >
            ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚úì
          </button>
        </div>
      </div>
    </div>

    <!-- Main Container -->
    <div
      id="main-card"
      class="glass-card px-2 pt-2 pb-1 shadow-lg text-right w-full max-w-[96vw] mx-auto"
      style="border-color: rgba(255, 255, 255, 0.2)"
    >
      <!-- Top Bar: Title + Selectors + Settings -->
      <div class="mb-2 flex flex-wrap justify-between items-center gap-2">
        <!-- Left: Title & Dropdowns -->
        <div class="flex gap-2 flex-wrap items-center">
          <!-- Mini Title (Clickable) -->
          <div
            id="app-logo-container"
            class="mr-2 flex items-center hover:scale-105 transition-transform cursor-pointer"
            title="‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏±‡∏ä‡∏ç‡∏≤‡πÄ‡∏ï‡πã‡∏≤ (Click for Wisdom)"
          >
            <span class="text-3xl mr-2">‚òØÔ∏è</span>
            <span
              class="text-2xl font-bold bg-gradient-to-br from-purple-400 to-indigo-400 bg-clip-text text-transparent"
            >
              TaijiFlow AI
            </span>
          </div>

          <!-- Category Dropdown -->
          <div>
            <select
              id="category-select"
              class="px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:border-purple-500 focus:outline-none"
              title="Select exercise category"
            >
              <option value="" disabled>-- Category --</option>
              <option value="silk_single" selected>Silk Reeling - Single Hand</option>
              <!-- <option value="silk_double" disabled>Silk Reeling - Double Hand</option> -->
            </select>
          </div>

          <!-- Exercise Dropdown -->
          <div>
            <select
              id="exercise-select"
              class="px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:border-purple-500 focus:outline-none"
              title="Select exercise"
            >
              <option value="" disabled>-- Exercise --</option>
              <option value="rh_cw" selected>1. Right Hand - CW</option>
              <option value="rh_ccw">2. Right Hand - CCW</option>
              <option value="lh_cw">3. Left Hand - CW</option>
              <option value="lh_ccw">4. Left Hand - CCW</option>
              <option value="random">üé≤ Random Exercise</option>
            </select>
          </div>

          <!-- Level Dropdown (Moved after Exercise) -->
          <div>
            <select
              id="level-select"
              class="px-3 py-2 rounded bg-gray-700 text-white border border-gray-600 focus:border-purple-500 focus:outline-none"
              title="Select difficulty level"
            >
              <option value="" disabled>-- Level --</option>
              <option value="L1" selected>1. Level 1 (Seated)</option>
              <option value="L2">2. Level 2 (Standing)</option>
              <option value="L3">3. Level 3 (Bow Stance)</option>
            </select>
          </div>

          <!-- Display Options Dropdown -->
          <div class="relative" id="display-dropdown-container">
            <button
              id="display-btn"
              class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 transition-colors"
              title="Display Options - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•"
              aria-label="Display Options"
            >
              üëÅÔ∏è
            </button>
            <!-- Dropdown Menu -->
            <div
              id="display-menu"
              class="hidden absolute right-0 mt-2 w-[500px] bg-gray-900/95 backdrop-blur-md border border-gray-700/50 rounded-lg shadow-xl z-50 overflow-hidden"
              style="max-height: 85vh; overflow-y: auto"
            >
              <div
                class="p-2 text-xs text-center text-gray-400 border-b border-gray-700 bg-gray-900 font-bold tracking-wider"
              >
                DISPLAY OPTIONS
              </div>

              <!-- 2-Column Grid Wrapper -->
              <div class="grid grid-cols-2 gap-0 items-start">
                
                <!-- ==================== LEFT COLUMN ==================== -->
                <div class="flex flex-col border-r border-gray-700/50 min-h-full">
                  
                  <!-- ===== üë§ Trainee/You Section ===== -->
                  <div
                    class="px-4 py-1.5 text-xs text-purple-300 bg-purple-900/50 uppercase font-bold tracking-wider"
                  >
                    Trainee/You
                  </div>
                  <!-- Skeleton -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show your skeleton overlay"
                  >
                    <input
                      type="checkbox"
                      id="check-skeleton"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                      checked
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">ü¶¥ Skeleton</span>
                      <span class="text-xs text-gray-400 mt-1">Track your joints in real-time</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">K</span>
                  </label>
                  <!-- Error Highlights -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show red highlights on incorrect joints"
                  >
                    <input
                      type="checkbox"
                      id="check-error-highlights"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                      checked
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üéØ Err. Highlight</span>
                      <span class="text-xs text-gray-400 mt-1">Show red dots on mistakes</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">E</span>
                  </label>
                  <!-- Trail -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show wrist movement trail"
                  >
                    <input
                      type="checkbox"
                      id="check-trail"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                      checked
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">‚òÑÔ∏è Motion Trail</span>
                      <span class="text-xs text-gray-400 mt-1">Track hand movement history</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">R</span>
                    <button id="btn-trail-settings" class="ml-2 p-1 w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-600 text-gray-400 transition-transform duration-200" title="Toggle Settings">‚ñº</button>
                  </label>
                  
                  <!-- Trail Settings -->
                  <div
                    id="trail-settings"
                    class="hidden px-4 py-2 bg-gray-800/50 border-b border-gray-700/30 space-y-2"
                  >
                    <!-- Length -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Length</span>
                      <select id="trail-length" class="bg-gray-700 text-white text-xs rounded border border-gray-600 px-1 py-0.5" title="Length of the trail">
                        <option value="30">Short</option>
                        <option value="60" selected>Medium</option>
                        <option value="90">Long</option>
                      </select>
                    </div>
                    <!-- Color -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Color</span>
                      <div class="flex gap-2">
                        <!-- Cyan (Default) -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-cyan-400 hover:scale-110 trail-color-btn active ring-2 ring-blue-500 relative transition-transform" data-color="100, 200, 255" title="Cyan"></button>
                        <!-- Green (Match Path - Distinct) -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-green-400 hover:scale-110 trail-color-btn relative transition-transform" data-color="50, 255, 100" title="Green"></button>
                        <!-- Yellow (Contrast) -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-yellow-400 hover:scale-110 trail-color-btn relative transition-transform" data-color="255, 215, 0" title="Yellow"></button>
                      </div>
                    </div>
                  </div>

                  <!-- ===== üëÅÔ∏è View Section ===== -->
                  <div
                    class="px-4 py-1.5 text-xs text-blue-300 bg-blue-900/50 uppercase font-bold tracking-wider mt-0"
                  >
                    View
                  </div>
                  <!-- Mirror Mode -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Toggle mirror mode (flip horizontally)"
                  >
                    <input
                      type="checkbox"
                      id="check-mirror"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                      checked
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">ü™û Mirror Mode</span>
                      <span class="text-xs text-gray-400 mt-1">Flip display horizontally</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">M</span>
                  </label>
                  <!-- Path -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show dynamic path guide"
                  >
                    <input
                      type="checkbox"
                      id="check-path"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                      checked
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üõ£Ô∏è Path Guide</span>
                      <span class="text-xs text-gray-400 mt-1">Dynamic movement guide</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">P</span>
                    <button id="btn-path-settings" class="ml-2 p-1 w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-600 text-gray-400 transition-transform duration-200" title="Toggle Settings">‚ñº</button>
                  </label>
                  
                  <!-- Path Settings -->
                  <div
                    id="path-settings"
                    class="hidden px-4 py-2 bg-gray-800/50 border-b border-gray-700/30 space-y-2"
                  >
                    <!-- Thickness -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Thickness</span>
                      <select id="path-width" class="bg-gray-700 text-white text-xs rounded border border-gray-600 px-1 py-0.5">
                        <option value="4" selected>Thin</option>
                        <option value="8">Thick</option>
                      </select>
                    </div>
                    <!-- Color -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Color</span>
                      <div class="flex gap-2">
                        <!-- Green (Default) -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-green-500 hover:scale-110 path-color-btn active ring-2 ring-blue-500 relative transition-transform" data-color="0, 255, 0" title="Green"></button>
                        <!-- Yellow -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-yellow-400 hover:scale-110 path-color-btn relative transition-transform" data-color="255, 255, 0" title="Yellow"></button>
                        <!-- Magenta -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-fuchsia-500 hover:scale-110 path-color-btn relative transition-transform" data-color="255, 0, 255" title="Magenta"></button>
                      </div>
                    </div>
                  </div>
                  <!-- Grid Overlay -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show grid lines for reference"
                  >
                    <input
                      type="checkbox"
                      id="check-grid"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üìê Grid Overlay</span>
                      <span class="text-xs text-gray-400 mt-1">Position reference lines</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">G</span>
                    <button id="btn-grid-settings" class="ml-2 p-1 w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-600 text-gray-400 transition-transform duration-200" title="Toggle Settings">‚ñº</button>
                  </label>
                  
                  <!-- Grid Settings -->
                  <div
                    id="grid-settings"
                    class="hidden px-4 py-2 bg-gray-800/50 border-b border-gray-700/30 space-y-2"
                  >
                    <!-- Size -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Size</span>
                      <select id="grid-size" class="bg-gray-700 text-white text-xs rounded border border-gray-600 px-1 py-0.5">
                        <option value="60">Small</option>
                        <option value="100" selected>Medium</option>
                        <option value="140">Large</option>
                      </select>
                    </div>
                    <!-- Color -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Color</span>
                      <div class="flex gap-2">
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-white grid-color-btn active ring-2 ring-blue-500" data-color="255, 255, 255" title="White"></button>
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-gray-400 grid-color-btn" data-color="150, 150, 150" title="Gray"></button>
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-red-500 grid-color-btn" data-color="255, 50, 50" title="Red"></button>
                      </div>
                    </div>
                    <!-- Opacity -->
                    <div class="flex flex-col gap-1">
                      <div class="flex justify-between">
                        <span class="text-xs text-gray-400">Opacity</span>
                        <span id="grid-opacity-val" class="text-xs text-gray-300">40%</span>
                      </div>
                      <input type="range" id="grid-opacity" min="20" max="80" value="40" step="10" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer" />
                    </div>
                  </div>
                </div>

                <!-- ==================== RIGHT COLUMN ==================== -->
                <div class="flex flex-col min-h-full">
                  
                  <!-- ===== üìö Reference Section ===== -->
                  <div
                    class="px-4 py-1.5 text-xs text-indigo-300 bg-indigo-900/50 uppercase font-bold tracking-wider"
                  >
                    Reference/Instructor
                  </div>
                  <!-- Instructor PiP -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show instructor shadow in corner thumbnail"
                  >
                    <input
                      type="checkbox"
                      id="check-instructor"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                      checked
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üéì Instructor PiP</span>
                      <span class="text-xs text-gray-400 mt-1">Corner video overlay</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">I</span>
                  </label>
                  <!-- Side-by-Side Mode -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Split screen: Instructor (Left) vs You (Right)"
                  >
                    <input
                      type="checkbox"
                      id="check-side-by-side"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üëØ Side-by-Side</span>
                      <span class="text-xs text-gray-400 mt-1">Split screen comparison</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">S</span>
                  </label>
                  <!-- Ghost Overlay -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show instructor shadow on main video"
                  >
                    <input
                      type="checkbox"
                      id="check-ghost"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üëª Ghost Overlay</span>
                      <span class="text-xs text-gray-400 mt-1">Full body reference shadow</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">O</span>
                    <button id="btn-ghost-settings" class="ml-2 p-1 w-6 h-6 flex items-center justify-center rounded-full hover:bg-gray-600 text-gray-400 transition-transform duration-200" title="Toggle Settings">‚ñº</button>
                  </label>
                  
                  <!-- Ghost Settings -->
                  <div
                    id="ghost-settings"
                    class="hidden px-4 py-2 bg-gray-800/50 border-b border-gray-700/30 space-y-2"
                  >
                    <!-- Opacity -->
                    <div class="flex flex-col gap-1">
                      <div class="flex justify-between">
                        <span class="text-xs text-gray-400">Opacity</span>
                        <span id="ghost-opacity-val" class="text-xs text-gray-300">60%</span>
                      </div>
                      <input type="range" id="ghost-opacity" min="20" max="80" value="60" step="10" class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer" />
                    </div>
                    <!-- Tint -->
                    <div class="flex items-center justify-between">
                      <span class="text-xs text-gray-400">Tint</span>
                      <div class="flex gap-2">
                        <!-- Cyan -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-cyan-400 hover:scale-110 ghost-color-btn active ring-2 ring-blue-500 relative" data-color="100, 200, 255" title="Cyan"></button>
                        <!-- Gold -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-yellow-400 hover:scale-110 ghost-color-btn relative" data-color="255, 215, 0" title="Gold"></button>
                        <!-- Red -->
                        <button class="w-4 h-4 rounded-full border border-gray-500 bg-red-500 hover:scale-110 ghost-color-btn relative" data-color="255, 40, 40" title="Red"></button>
                      </div>
                    </div>
                  </div>

                  <!-- ===== üõ†Ô∏è Developer Section ===== -->
                  <div
                    class="px-4 py-1.5 text-xs text-red-300 bg-red-900/50 uppercase font-bold tracking-wider mt-2"
                  >
                    Developer
                  </div>
                  <!-- Debug Mode -->
                  <label
                    class="flex items-start px-4 py-2 hover:bg-gray-700 cursor-pointer border-b border-gray-700/30 transition-colors"
                    title="Show debug information (threshold values)"
                  >
                    <input
                      type="checkbox"
                      id="check-debug"
                      class="mr-3 mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                    />
                    <div class="flex flex-col flex-1">
                      <span class="text-sm font-bold text-white leading-tight">üêû Debug Info</span>
                      <span class="text-xs text-gray-400 mt-1">Show system performance</span>
                    </div>
                    <span class="text-[16px] text-gray-400 bg-gray-700 px-1.5 py-0.5 rounded ml-2 h-fit">D</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

          <!-- Rules Settings Dropdown -->
          <div class="relative">
            <button
              id="rules-btn"
              class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 transition-colors"
              title="Rules Settings - ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö"
              aria-label="Rules Settings"
            >
              üîß
            </button>

            <div
              id="rules-menu"
              class="hidden absolute right-0 mt-2 w-64 bg-gray-900/90 backdrop-blur-md border border-gray-700/50 rounded-lg shadow-xl z-50 overflow-hidden no-scrollbar"
              style="max-height: 78vh; overflow-y: scroll"
              >
              <div
                class="p-2 text-xs text-center text-gray-400 border-b border-gray-700 bg-gray-900 sticky top-0"
              >
                Rules Settings
              </div>

              <!-- ===== L1: ‡∏ô‡∏±‡πà‡∏á (3 ‡∏Å‡∏é) ===== -->
              <div
                class="text-xs text-center py-1 bg-green-900/50 text-green-300 border-b border-gray-600"
              >
                L1: ‡∏ô‡∏±‡πà‡∏á (3 ‡∏Å‡∏é)
              </div>

              <!-- Rule 1: Path Shape -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-path"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >1. Path Shape</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Consistency:</span>
                    <input
                      type="number"
                      id="threshold-path"
                      value="0.6"
                      step="0.05"
                      min="0.3"
                      max="0.9"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.3-0.9)</div>
                  </div>
                </div>
              </div>

              <!-- Rule 3: Elbow Sinking -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-elbow"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >3. Elbow Sinking</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Tolerance:</span>
                    <input
                      type="number"
                      id="threshold-elbow"
                      value="0.01"
                      step="0.005"
                      min="0.005"
                      max="0.05"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.005-0.05)</div>
                  </div>
                </div>
              </div>

              <!-- Rule 7: Continuity -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-continuity"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >7. Continuity</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1 mb-1">
                    <span>Threshold:</span>
                    <input
                      type="number"
                      id="threshold-motion"
                      value="0.003"
                      step="0.001"
                      min="0.001"
                      max="0.01"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <span class="text-gray-500">(0.001-0.01)</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <span>Window (s):</span>
                    <input
                      type="number"
                      id="threshold-pause"
                      value="2"
                      step="0.5"
                      min="1"
                      max="5"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <span class="text-gray-500">(1-5)</span>
                  </div>
                </div>
              </div>

              <!-- ===== L2: ‡∏¢‡∏∑‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 3 ‡∏Å‡∏é) ===== -->
              <div
                class="text-xs text-center py-1 bg-blue-900/50 text-blue-300 border-b border-gray-600"
              >
                L2: ‡∏¢‡∏∑‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 3 ‡∏Å‡∏é)
              </div>

              <!-- Rule 2: Arm Rotation -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-rotation"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >2. Arm Rotation</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Motion:</span>
                    <input
                      type="number"
                      id="threshold-rotation"
                      value="0.015"
                      step="0.005"
                      min="0.005"
                      max="0.05"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.005-0.05)</div>
                  </div>
                </div>
              </div>

              <!-- Rule 4: Waist Initiation -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-waist"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >4. Waist Initiation</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1 mb-1">
                    <span>Hip Vel:</span>
                    <input
                      type="number"
                      id="threshold-hip-vel"
                      value="1.0"
                      step="0.5"
                      min="0.5"
                      max="10"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <span class="text-gray-500">(0.5-10.0)</span>
                  </div>
                  <div class="flex items-center gap-1">
                    <span>S/H Ratio:</span>
                    <input
                      type="number"
                      id="threshold-sh-ratio"
                      value="2.0"
                      step="0.5"
                      min="1"
                      max="10"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <span class="text-gray-500">(1.0-10.0)</span>
                  </div>
                </div>
              </div>

              <!-- Rule 6: Smoothness -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-smooth"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >6. Smoothness</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Threshold:</span>
                    <input
                      type="number"
                      id="threshold-smooth"
                      value="0.05"
                      step="0.01"
                      min="0.01"
                      max="0.15"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.01-0.15)</div>
                  </div>
                </div>
              </div>

              <!-- ===== L3: ‡∏¢‡∏∑‡∏ô‡∏¢‡πà‡∏≠ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 3 ‡∏Å‡∏é) ===== -->
              <div
                class="text-xs text-center py-1 bg-purple-900/50 text-purple-300 border-b border-gray-600"
              >
                L3: ‡∏¢‡∏∑‡∏ô‡∏¢‡πà‡∏≠ (‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å 3 ‡∏Å‡∏é)
              </div>

              <!-- Rule 5: Vertical Stability -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-stability"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >5. Vertical Stability</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Threshold:</span>
                    <input
                      type="number"
                      id="threshold-stability"
                      value="0.05"
                      step="0.01"
                      min="0.01"
                      max="0.15"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.01-0.15)</div>
                  </div>
                </div>
              </div>

              <!-- Rule 8: Weight Shift -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-weight"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >8. Weight Shift</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Buffer:</span>
                    <input
                      type="number"
                      id="threshold-weight"
                      value="0.3"
                      step="0.05"
                      min="0.05"
                      max="0.50"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.05-0.50)</div>
                  </div>
                </div>
              </div>

              <!-- Rule 9: Upper-Lower Coordination -->
              <div class="rule-item p-2 border-b border-gray-700">
                <label class="flex items-center cursor-pointer">
                  <input
                    type="checkbox"
                    id="rule-coordination"
                    class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500 focus:ring-offset-gray-800"
                  />
                  <span class="text-sm font-bold text-white ml-2"
                    >9. Upper-Lower Coordination</span
                  >
                </label>
                <div class="ml-8 mt-1 text-xs text-gray-400">
                  <div class="flex items-center gap-1">
                    <span>Vel Thresh:</span>
                    <input
                      type="number"
                      id="threshold-coordination"
                      value="0.02"
                      step="0.01"
                      min="0.01"
                      max="0.10"
                      class="w-16 px-1 py-0.5 bg-gray-700 text-white rounded text-center"
                    />
                    <div class="text-gray-500">(0.01-0.10)</div>
                  </div>
                </div>
              </div>

              <!-- Reset Button -->
              <div class="p-2 sticky bottom-0 bg-gray-800">
                <button
                  id="rules-reset-btn"
                  class="w-full py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm"
                >
                  üîÑ Reset to Defaults
                </button>
              </div>
            </div>
          </div>

          <!-- Settings Menu (Performance + Effects + Backgrounds) -->
          <div class="relative inline-block">
            <button
              id="settings-btn"
              class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 transition-colors"
              title="Settings - Performance & Effects"
            >
              ‚öôÔ∏è
            </button>

            <!-- Settings Dropdown Menu -->
            <div
              id="settings-menu"
              class="hidden absolute right-0 mt-2 w-56 bg-gray-900/90 backdrop-blur-md border border-gray-700/50 rounded-lg shadow-xl z-50 overflow-hidden"
              style="max-height: 78vh; overflow-y: auto"
            >
              <div
                class="p-2 text-xs text-center text-gray-400 border-b border-gray-700 bg-gray-900 sticky top-0"
              >
                Settings
              </div>

              <!-- ===== ‚ö° Performance Section ===== -->
              <div
                class="px-4 py-1 text-xs text-blue-300 bg-blue-900/50 uppercase font-bold tracking-wider mt-1"
              >
                Performance
              </div>

              <!-- Option: Lite -->
              <button
                class="perf-option flex items-center px-4 py-3 hover:bg-gray-700 text-left transition-colors border-b border-gray-700/50 w-full"
                data-value="lite"
                onclick="window.selectPerformanceMode('lite')"
              >
                <span class="mr-3 text-lg">‚ö°</span>
                <div class="flex flex-col">
                  <span class="text-sm font-bold text-white">Lite</span>
                  <span class="text-xs text-gray-400">Fastest (Low Res)</span>
                </div>
                <span class="ml-auto text-green-400 opacity-0 check-icon"
                  >‚úì</span
                >
              </button>

              <!-- Option: Balanced -->
              <button
                class="perf-option flex items-center px-4 py-3 hover:bg-gray-700 text-left transition-colors border-b border-gray-700/50 w-full"
                data-value="balanced"
                onclick="window.selectPerformanceMode('balanced')"
              >
                <span class="mr-3 text-lg">‚öñÔ∏è</span>
                <div class="flex flex-col">
                  <span class="text-sm font-bold text-white">Balanced</span>
                  <span class="text-xs text-gray-400"
                    >Default (Recommended)</span
                  >
                </div>
                <span class="ml-auto text-green-400 opacity-0 check-icon"
                  >‚úì</span
                >
              </button>

              <!-- Option: Quality -->
              <button
                class="perf-option flex items-center px-4 py-3 hover:bg-gray-700 text-left transition-colors border-b border-gray-700/50 w-full"
                data-value="quality"
                onclick="window.selectPerformanceMode('quality')"
              >
                <span class="mr-3 text-lg">üíé</span>
                <div class="flex flex-col">
                  <span class="text-sm font-bold text-white">Quality</span>
                  <span class="text-xs text-gray-400">Best (High Res)</span>
                </div>
                <span class="ml-auto text-green-400 opacity-0 check-icon"
                  >‚úì</span
                >
              </button>

              <!-- ===== üõ†Ô∏è Effects Section ===== -->
              <div
                class="px-4 py-1 text-xs text-yellow-300 bg-yellow-900/50 uppercase font-bold tracking-wider mt-2"
              >
                Effects
              </div>

              <!-- Auto-Adjust Light -->
              <label
                class="flex items-center px-4 py-3 hover:bg-gray-700 cursor-pointer border-b border-gray-700/50 transition-colors"
                title="Automatically adjust brightness in low light conditions"
              >
                <input
                  type="checkbox"
                  id="check-auto-adjust-light"
                  class="mr-2 w-4 h-4 rounded border-gray-600 bg-gray-700 text-yellow-600 focus:ring-yellow-500 focus:ring-offset-gray-800"
                />
                <div class="flex flex-col flex-1">
                  <span class="text-sm font-bold text-white"
                    >üîÜ Auto-Adjust Light</span
                  >
                  <span class="text-xs text-gray-400"
                    >Brighten in low light</span
                  >
                </div>
              </label>

              <!-- ===== üñºÔ∏è Virtual Backgrounds Section ===== -->
              <div class="px-4 py-3 border-b border-gray-700/50">
                <div class="text-sm font-bold text-white mb-2">
                  üñºÔ∏è Virtual Backgrounds
                </div>
                <div class="grid grid-cols-3 gap-2">
                  <!-- None -->
                  <button
                    class="bg-option active flex flex-col items-center p-2 rounded border-2 border-green-500 hover:border-blue-500 transition-colors"
                    data-bg="none"
                    data-vbg-key="none"
                    title="No background effect"
                  >
                    <div
                      class="w-full h-12 bg-gray-600 rounded flex items-center justify-center text-xs text-gray-400"
                    >
                      None
                    </div>
                    <span class="text-[10px] text-gray-400 mt-1">None</span>
                  </button>

                  <!-- Blur -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="blur"
                    data-vbg-key="blur"
                    title="Blur background"
                  >
                    <div
                      class="w-full h-12 bg-gradient-to-br from-gray-500 to-gray-700 rounded flex items-center justify-center text-xs text-white backdrop-blur"
                    >
                      Blur
                    </div>
                    <span class="text-[10px] text-gray-400 mt-1">Blur</span>
                  </button>

                  <!-- Silhouette -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="silhouette"
                    data-vbg-key="silhouette"
                    title="Silhouette effect"
                  >
                    <div
                      class="w-full h-12 bg-black rounded flex items-center justify-center text-xs text-white"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6 text-white"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                        />
                      </svg>
                    </div>
                    <span class="text-[10px] text-gray-400 mt-1"
                      >Silhouette</span
                    >
                  </button>

                  <!-- Mountain Mist -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="mountain"
                    data-vbg-key="mountain"
                    title="Mountain Mist"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/mountain_mist_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Mountain"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Mountain</span>
                  </button>

                  <!-- Bamboo Forest -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="bamboo"
                    data-vbg-key="bamboo"
                    title="Bamboo Forest"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/bamboo_forest_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Bamboo"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Bamboo</span>
                  </button>

                  <!-- Zen Garden -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="zen_garden"
                    data-vbg-key="zen_garden"
                    title="Zen Garden"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/zen_garden_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Zen Garden"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Zen</span>
                  </button>

                  <!-- Sunrise Lake -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="lake"
                    data-vbg-key="lake"
                    title="Sunrise Lake"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/sunrise_lake_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Lake"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Lake</span>
                  </button>

                  <!-- Temple -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="temple"
                    data-vbg-key="temple"
                    title="Temple Courtyard"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/temple_courtyard_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Temple"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Temple</span>
                  </button>

                  <!-- Dojo -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="dojo"
                    data-vbg-key="dojo"
                    title="Wooden Dojo"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/wooden_dojo_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Dojo"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Dojo</span>
                  </button>

                  <!-- Minimalist -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="minimalist"
                    data-vbg-key="minimalist"
                    title="Modern Minimalist"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/modern_minimalist_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Minimalist"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Minimal</span>
                  </button>

                  <!-- Gradient -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="gradient"
                    data-vbg-key="gradient"
                    title="Soft Gradient"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/soft_gradient_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Gradient"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Gradient</span>
                  </button>

                  <!-- Clouds -->
                  <button
                    class="bg-option flex flex-col items-center p-2 rounded border-2 border-transparent hover:border-blue-500 transition-colors"
                    data-bg="clouds"
                    data-vbg-key="clouds"
                    title="Yin Yang Clouds"
                  >
                    <img
                      src="assets/backgrounds/thumbnails/yin_yang_clouds_thumb.jpg"
                      class="w-full h-12 rounded object-cover"
                      alt="Clouds"
                    />
                    <span class="text-[10px] text-gray-400 mt-1">Clouds</span>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right: Settings Buttons -->
        <div class="flex gap-2">
          <!-- Audio Button -->
          <button
            id="audio-btn"
            class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 transition-colors"
            title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î"
          >
            üîä
          </button>

          <!-- Language Button -->
          <button
            id="lang-btn"
            class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 font-bold transition-colors"
            title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤ TH/EN - Switch language"
          >
            üáπüá≠
          </button>
          <!-- Theme Button -->
          <button
            id="theme-btn"
            class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 transition-colors"
            title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ò‡∏µ‡∏° ‡∏™‡∏ß‡πà‡∏≤‡∏á/‡∏°‡∏∑‡∏î - Toggle dark/light mode"
          >
            üåô
          </button>
          <!-- Shortcuts Button (Moved from Left) -->
          <button
            id="shortcuts-btn"
            class="px-2 py-2 md:px-3 md:py-2 bg-gray-700 text-white border border-gray-600 rounded hover:bg-gray-600 transition-colors"
            title="‡∏Ñ‡∏µ‡∏¢‡πå‡∏•‡∏±‡∏î (Shortcuts)"
            onclick="window.shortcutsManager.toggle()"
          >
            üéπ
          </button>
        </div>
      </div>

      <!-- Canvas Container (Full Width) -->
      <div
        class="canvas-container relative bg-black rounded overflow-hidden shadow-xl mb-2"
      >
        <!-- Instructor Video Container (Left side in Split Screen) -->
        <div id="instructor-video-container" class="hidden"></div>

        <video
          id="input_video"
          style="display: none"
          autoplay
          playsinline
        ></video>
        <canvas id="output_canvas" width="1280" height="720"></canvas>

        <!-- Instructor Thumbnail (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô) -->
        <canvas id="instructor-thumbnail"></canvas>

        <!-- Feedback Overlay (HTML - ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å CSS mirror) -->
        <div
          id="feedback-overlay"
          class="absolute top-4 left-4 z-30 hidden bg-black/75 rounded-[10px] px-4 py-3 font-['Sarabun',sans-serif] min-w-[280px] max-w-[450px]"
        >
          <div
            id="feedback-content"
            class="text-[#ffd700] text-lg font-bold leading-normal"
          >
            <!-- Feedback messages will be inserted here by JS -->
          </div>
        </div>

        <!-- Debug Overlay (HTML - ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å CSS mirror) -->
        <div
          id="debug-overlay"
          class="absolute top-4 right-4 z-30 hidden bg-[#000028]/95 border-2 border-[#00ffff] rounded-[10px] px-4 py-3 font-mono min-w-[280px]"
        >
          <div class="text-[#00ffff] text-base font-bold mb-2">
            üêû DEBUG MODE
          </div>
          <div
            id="debug-content"
            class="text-[#00ff00] text-sm leading-relaxed"
          >
            <!-- Debug values will be inserted here by JS -->
          </div>
        </div>

        <!-- Loading Overlay -->
        <div
          id="loading-overlay"
          class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-80 text-white text-xl z-20 hidden rounded-lg"
        >
          <div class="flex flex-col items-center">
            <svg
              class="animate-spin h-10 w-10 text-white mb-3"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            <span id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• AI...</span>
          </div>
        </div>

        <!-- Start Overlay (‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô) -->
        <div
          id="start-overlay"
          class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-70 z-10 rounded-lg transition-opacity duration-300 p-8"
        >
          <h2
            id="overlay-title"
            class="text-white text-2xl font-bold mb-6 drop-shadow-md"
          >
            üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
          </h2>

          <!-- Quickstart Box (‡πÄ‡∏ô‡πâ‡∏ô) -->
          <div
            id="quickstart-box"
            class="p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-white/30 max-w-md mb-4"
          >
            <h3
              id="quickstart-title"
              class="bg-gradient-to-br from-purple-500 to-indigo-500 bg-clip-text text-transparent text-lg font-bold mb-2 text-center"
            >
              ‚ö° Quickstart
            </h3>
            <p id="quickstart-action" class="text-white text-center mb-2">
              ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "üèÉ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å" ‡∏´‡∏£‡∏∑‡∏≠ ‡∏¢‡∏Å‡∏ô‡∏¥‡πâ‡∏ß‡πÇ‡∏õ‡πâ‡∏á üëç
            </p>
            <p
              id="quickstart-default"
              class="text-gray-400 text-sm text-center"
            >
              ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏ó‡πà‡∏≤‡∏°‡πâ‡∏ß‡∏ô‡πÑ‡∏´‡∏° - ‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ - ‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏° - ‡πÅ‡∏ö‡∏ö‡∏ô‡∏±‡πà‡∏á
            </p>
          </div>

          <!-- Divider -->
          <p id="or-customize" class="text-gray-500 text-sm mb-4">
            ‚îÄ‚îÄ‚îÄ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏á ‚îÄ‚îÄ‚îÄ
          </p>

          <!-- Optional Steps (1-2-3) -->
          <div
            class="text-white text-base text-left space-y-2 max-w-md opacity-80"
          >
            <p class="flex items-center gap-3">
              <span
                class="bg-gradient-to-br from-purple-500 to-indigo-500 text-white rounded-full w-7 h-7 flex items-center justify-center font-bold text-sm shadow-md"
                >1</span
              >
              <span id="overlay-step1" class="text-sm"
                >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å"</strong> ‡∏´‡∏£‡∏∑‡∏≠
                <strong>"üé≤ ‡∏™‡∏∏‡πà‡∏°‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å"</strong></span
              >
            </p>
            <p class="flex items-center gap-3">
              <span
                class="bg-gradient-to-br from-purple-500 to-indigo-500 text-white rounded-full w-7 h-7 flex items-center justify-center font-bold text-sm shadow-md"
                >2</span
              >
              <span id="overlay-step2" class="text-sm"
                >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö"</strong> ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</span
              >
            </p>
            <p class="flex items-center gap-3">
              <span
                class="bg-gradient-to-br from-purple-500 to-indigo-500 text-white rounded-full w-7 h-7 flex items-center justify-center font-bold text-sm shadow-md"
                >3</span
              >
              <span id="overlay-step3" class="text-sm"
                >‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>"‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å"</strong></span
              >
            </p>
          </div>

          <!-- Stop Box (New) -->
          <div
            id="stop-box"
            class="mt-6 p-4 bg-gray-800 bg-opacity-50 rounded-lg border border-white/30 max-w-md"
          >
            <h3
              id="stop-title"
              class="text-red-400 text-lg font-bold mb-2 text-center"
            >
              Stop
            </h3>
            <p id="stop-action" class="text-white text-center mb-2">
              ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å" ‡∏´‡∏£‡∏∑‡∏≠ ‚úä ‡∏Å‡∏≥‡∏°‡∏∑‡∏≠
            </p>
            <p id="stop-auto-finish" class="text-gray-400 text-sm text-center">
              ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 5 ‡∏ô‡∏≤‡∏ó‡∏µ
            </p>
          </div>
        </div>

        <!-- Countdown Overlay (3-2-1) -->
        <div id="countdown-overlay" class="countdown-overlay hidden">
          <span id="countdown-number" class="countdown-number">3</span>
        </div>

        <!-- Fullscreen Button (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á - ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ù‡∏∂‡∏Å) -->
        <div
          id="fullscreen-overlay-btn"
          class="absolute bottom-4 right-4 z-20 hidden"
        >
          <button
            id="video-fullscreen-btn"
            class="flex items-center gap-2 bg-black bg-opacity-70 px-3 py-2 rounded-full text-white font-bold hover:bg-opacity-90 transition"
            title="‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠"
          >
            ‚õ∂ <span id="fullscreen-btn-text">‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠</span>
          </button>
        </div>

        <!-- Training Timer Overlay (‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á - ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ù‡∏∂‡∏Å) -->
        <div
          id="training-controls"
          class="absolute bottom-4 left-4 z-20 hidden"
        >
          <div
            class="flex items-center gap-3 bg-black bg-opacity-70 px-4 py-2 rounded-full"
          >
            <span class="text-white font-bold">‚è±Ô∏è</span>
            <span id="training-timer-overlay" class="text-white font-bold"
              >5:00</span
            >
            <span class="text-gray-400">|</span>
            <button
              id="stop-training-overlay-btn"
              class="text-red-400 hover:text-red-300 font-bold flex items-center gap-1 transition-colors"
              title="‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å"
            >
              üõë <span id="stop-btn-text">‡∏´‡∏¢‡∏∏‡∏î</span>
            </button>
          </div>
        </div>
          </div>
        
      <!-- Control Buttons (Start/Stop - Separate) -->
      <div class="flex justify-center gap-4 mt-2 mb-2">
        <button
          id="start-training-btn"
          class="bg-gradient-to-br from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 hover:-translate-y-0.5 hover:shadow-xl hover:shadow-purple-500/30 text-white font-bold py-2 md:py-3 px-6 md:px-8 rounded-lg transition-all duration-200 text-lg opacity-50 cursor-not-allowed shadow-lg"
          disabled
        >
          ‚ñ∂Ô∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å
        </button>
        <button
          id="stop-training-btn"
          class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 md:py-3 px-6 md:px-8 rounded-lg transition text-lg opacity-50 cursor-not-allowed"
          disabled
        >
          ‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å
        </button>
      </div></div>
        
        </div>

      </div>


      <!-- Instructions (Hidden for now - will add more useful tips later) -->
      <div class="instructions-box p-4 rounded text-left hidden">
        <h3 id="instr-title" class="font-bold mb-2">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</h3>
        <ul class="list-disc list-inside text-sm space-y-1">
          <li id="instr-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å'</li>
          <li id="instr-2">‡∏¢‡∏∑‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏±‡∏ß ‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á 2-3 ‡πÄ‡∏°‡∏ï‡∏£</li>
          <li id="instr-3">‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å</li>
        </ul>
      </div>
    </div>

    <!-- Hidden Legacy Elements (for script.js compatibility) -->
    <div class="hidden">
      <button id="small-calibrate-btn"></button>
      <button id="cancel-calib-btn"></button>
      <button id="fullscreen-btn"></button>
      <button id="record-btn"></button>
      <div id="level-buttons">
        <button class="level-btn" data-level="L1"></button>
        <button class="level-btn" data-level="L2"></button>
        <button class="level-btn" data-level="L3"></button>
      </div>
    </div>

    <!-- Notification Container -->
    <div
      id="notification-container"
      class="fixed top-5 right-5 z-50 flex flex-col items-end gap-3"
    >
      <!-- Notifications will be injected here by JavaScript -->
    </div>
  </body>
</html>
