# TaijiFlow AI - Calibration Manager Documentation

**Version:** 1.1  
**Last Updated:** 2024-12-24  
**Lines:** 362  
**Class:** CalibrationManager

---

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°)
2. [T-Pose Detection](#2-t-pose-detection)
3. [Body Metrics](#3-body-metrics)
4. [Methods Reference](#4-methods-reference)
5. [Level-based Visibility](#5-level-based-visibility)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

`CalibrationManager` ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏° Session

### üéØ ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å

| ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| **T-Pose Detection** | ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô |
| **Body Measurement** | ‡∏ß‡∏±‡∏î‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô (‡∏•‡∏≥‡∏ï‡∏±‡∏ß, ‡πÑ‡∏´‡∏•‡πà, ‡πÅ‡∏Ç‡∏ô) |
| **LocalStorage** | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î calibration data |
| **Overlay Drawing** | ‡∏ß‡∏≤‡∏î UI ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á calibrate |

### üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

```javascript
const calibration = new CalibrationManager();
calibration.setLevel("L1");
calibration.start();

// ‡∏ó‡∏∏‡∏Å frame
const result = calibration.process(landmarks);
if (result.status === 'complete') {
  engine.setCalibration(result.data);
}
```

---

## 2. T-Pose Detection

### ‡∏ó‡πà‡∏≤ T-Pose ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

```
           üë§ Head
            |
   ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚Üí
  Left      |       Right
  Arm     Torso     Arm
            |
          [Hips]
           /  \
         /      \
       L Leg   R Leg
```

### ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö

| ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| **Visibility** | ‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏∏‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (‡∏ï‡∏≤‡∏° Level) |
| **Arms Horizontal** | ‡πÅ‡∏Ç‡∏ô‡∏Å‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô |
| **Hold Time** | ‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ |

---

## 3. Body Metrics

### ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ

| Metric | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ | ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì |
|--------|---------|----------|
| `torsoHeight` | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß | ‡πÑ‡∏´‡∏•‡πà‡∏ñ‡∏∂‡∏á‡∏™‡∏∞‡πÇ‡∏û‡∏Å |
| `shoulderWidth` | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏•‡πà | ‡πÑ‡∏´‡∏•‡πà‡∏ã‡πâ‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏Ç‡∏ß‡∏≤ |
| `armLength` | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÅ‡∏Ç‡∏ô | ‡πÑ‡∏´‡∏•‡πà ‚Üí ‡∏®‡∏≠‡∏Å ‚Üí ‡∏Ç‡πâ‡∏≠‡∏°‡∏∑‡∏≠ |

### ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô Heuristics Engine

```javascript
// Dynamic threshold
const threshold = calibrationData.armLength * 0.1;
```

---

## 4. Methods Reference

### Setup Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `setLanguage(lang)` | ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏©‡∏≤ ("th"/"en") |
| `setLevel(level)` | ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Level ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö visibility |
| `getText(key)` | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤ |

### Lifecycle Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `start()` | ‡πÄ‡∏£‡∏¥‡πà‡∏° Calibration |
| `cancel()` | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å) |
| `process(landmarks)` | ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ó‡∏∏‡∏Å frame |

### Storage Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `saveToStorage()` | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á LocalStorage |
| `loadFromStorage()` | ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å LocalStorage |
| `hasStoredData()` | ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà |
| `clearStorage()` | ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |

### Calculation Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `calculateMetrics(landmarks)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏≤‡∏Å T-Pose |
| `drawOverlay(ctx, w, h)` | ‡∏ß‡∏≤‡∏î Overlay ‡∏ö‡∏ô Canvas |

---

## 5. Level-based Visibility

### Required Landmarks per Level

| Level | Required | ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô |
|-------|----------|------------|
| L1 | ‡πÑ‡∏´‡∏•‡πà, ‡∏™‡∏∞‡πÇ‡∏û‡∏Å | ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤ |
| L2 | ‡πÑ‡∏´‡∏•‡πà, ‡∏™‡∏∞‡πÇ‡∏û‡∏Å | ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤ |
| L3 | ‡πÑ‡∏´‡∏•‡πà, ‡∏™‡∏∞‡πÇ‡∏û‡∏Å, ‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤ | - |

### Logic

```javascript
// L1-L2: ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤
requiredIndices = [11, 12, 23, 24];

// L3: ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏ï‡∏±‡∏ß
if (level === "L3") {
  requiredIndices.push(27, 28); // ankles
}
```

---

*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å code analysis ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥*
