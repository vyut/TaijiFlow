# TaijiFlow AI - Heuristics Engine Documentation

**Version:** 3.0  
**Last Updated:** 2026-01-10  
**Lines:** 973  
**Class:** HeuristicsEngine

---

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç

1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°](#1-‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°)
2. [8 ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö](#2-8-‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö)
3. [CONFIG Thresholds](#3-config-thresholds)
4. [Methods Reference](#4-methods-reference)
5. [Level-based Rules](#5-level-based-rules)

---

## 1. ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

`HeuristicsEngine` ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å‡∏°‡πâ‡∏ß‡∏ô‡πÑ‡∏´‡∏° (Silk Reeling) ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏°‡∏ß‡∏¢‡πÑ‡∏ó‡πÄ‡∏Å‡πä‡∏Å‡∏ï‡∏£‡∏∞‡∏Å‡∏π‡∏•‡πÄ‡∏â‡∏¥‡∏ô

### üéØ Features

| Feature | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|---------|---------|
| **Dynamic Thresholds** | ‡∏õ‡∏£‡∏±‡∏ö Threshold ‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏à‡∏≤‡∏Å Calibration |
| **Priority System** | ‡∏à‡∏±‡∏î‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô |
| **Sticky Feedback** | ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ 1.5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏ó‡∏±‡∏ô |
| **Time-normalized** | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì velocity/acceleration ‡∏ï‡∏≤‡∏° timestamp ‡∏à‡∏£‡∏¥‡∏á |
| **Level-based Rules** | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏é‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏ï‡∏≤‡∏° Level (L1, L2, L3) |
| **Localization** | ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° feedback ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢/‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© |

### üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

```javascript
// ‡∏™‡∏£‡πâ‡∏≤‡∏á instance
const engine = new HeuristicsEngine();

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ calibration
engine.setCalibration(calibrationData);

// ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏©‡∏≤
engine.setLang("th");

// ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡πà‡∏≤ (‡∏ó‡∏∏‡∏Å frame)
const feedbacks = engine.analyze(
  landmarks,    // 33 ‡∏à‡∏∏‡∏î‡∏à‡∏≤‡∏Å MediaPipe
  timestamp,    // ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (ms)
  path,         // Reference Path
  exercise,     // "rh_cw", "lh_ccw", ...
  level         // "L1", "L2", "L3"
);
```

---

## 2. 8 ‡∏Å‡∏é‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ

| # | ‡∏Å‡∏é | ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡πÑ‡∏ó‡πÄ‡∏Å‡πä‡∏Å | Method |
|---|---|---------------|--------|
| 1 | Path Shape | ‡∏ß‡∏≤‡∏î‡∏ß‡∏á‡∏Å‡∏•‡∏° | `checkPathShape()` |
| 2 | Arm Rotation | ‡∏´‡∏°‡∏∏‡∏ô‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠ | `checkArmRotation()` |
| 3 | Elbow Sinking | ‡∏®‡∏≠‡∏Å‡∏à‡∏° | `checkElbowSinking()` |
| 4 | Waist Initiation | ‡πÄ‡∏≠‡∏ß‡∏ô‡∏≥ | `checkWaistInitiation()` |
| 5 | Vertical Stability | ‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏ô‡∏¥‡πà‡∏á | `checkVerticalStability()` |
| 6 | Smoothness | ‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏• | `checkSmoothness()` |
| 7 | Continuity | ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á | `checkContinuity()` |
| 8 | Weight Shift | ‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å | `checkWeightShift()` |

---

### 2.1 Rule 1: Path Shape (‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å‡∏ß‡∏≤‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°/‡∏ß‡∏á‡πÇ‡∏Ñ‡πâ‡∏á

**Algorithm (Direction Consistency):**
1. ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∏‡∏° degrees)
2. ‡∏î‡∏∂‡∏á‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á 10 ‡∏à‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏á‡∏™‡∏∏‡∏î
3. ‡∏ô‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏µ‡πà%
4. ‡∏ñ‡πâ‡∏≤ consistency ‚â• 70% = ‡∏ß‡∏á‡∏Å‡∏•‡∏°

```
‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏° (cw): 0¬∞ ‚Üí 45¬∞ ‚Üí 90¬∞ ‚Üí 135¬∞ ‚Üí 180¬∞
                      ‚Üë‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏¢‡πÜ = consistent
```

**Thresholds:**
- `CIRCLE_CONSISTENCY_THRESHOLD`: 0.70 (70%)
- `MIN_DIRECTION_SAMPLES`: 10 ‡∏à‡∏∏‡∏î

---

### 2.2 Rule 2: Arm Rotation (‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏Ç‡∏ô)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (Á∫èÁµ≤ÂãÅ - ‡∏ä‡∏≤‡∏ô‡∏ã‡∏∑‡∏≠‡∏à‡∏¥‡πâ‡∏ô):**
- ‡∏°‡πâ‡∏ß‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô (rising) ‚Üí ‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠‡∏Ñ‡∏ß‡πà‡∏≥ (thumb in)
- ‡∏°‡πâ‡∏ß‡∏ô‡∏•‡∏á (falling) ‚Üí ‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠‡∏´‡∏á‡∏≤‡∏¢ (thumb out)

**Algorithm:**
1. ‡∏´‡∏≤‡∏ó‡∏¥‡∏®‡∏´‡∏±‡∏ß‡πÅ‡∏°‡πà‡∏°‡∏∑‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ô‡∏¥‡πâ‡∏ß‡∏Å‡πâ‡∏≠‡∏¢
2. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß (rising/falling)
3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á ‚Üí feedback

```javascript
// rising + thumb out = ‡∏ñ‡∏π‡∏Å
// rising + thumb in  = ‡∏ú‡∏¥‡∏î "‡∏´‡∏°‡∏∏‡∏ô‡∏ù‡πà‡∏≤‡∏°‡∏∑‡∏≠"
```

---

### 2.3 Rule 3: Elbow Sinking (‡∏®‡∏≠‡∏Å‡∏à‡∏°)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (Ê≤âËÇ©Âù†ËÇò - ‡∏ä‡∏¥‡πà‡∏ô‡πÄ‡∏à‡∏µ‡∏¢‡∏ô ‡∏à‡∏∏‡πâ‡∏¢‡πÇ‡∏à‡πà‡∏ß):**
- ‡∏®‡∏≠‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏°‡∏•‡∏á‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà‡πÄ‡∏™‡∏°‡∏≠
- ‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏¢‡∏Å‡∏®‡∏≠‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏π‡∏á

**Algorithm:**
1. ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö Y (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á) ‡∏Ç‡∏≠‡∏á‡∏®‡∏≠‡∏Å‡∏Å‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà
2. ‡∏ñ‡πâ‡∏≤ elbow.y < shoulder.y - threshold ‚Üí ‡∏®‡∏≠‡∏Å‡∏•‡∏≠‡∏¢

**Threshold:** `ELBOW_THRESHOLD`: 0.03 (3% ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠)

---

### 2.4 Rule 4: Waist Initiation (‡πÄ‡∏≠‡∏ß‡∏ô‡∏≥)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (ËÖ∞ÁÇ∫‰∏ªÂÆ∞ - ‡πÄ‡∏≠‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏¢):**
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡πÄ‡∏≠‡∏ß/‡∏™‡∏∞‡πÇ‡∏û‡∏Å
- ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏•‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Ç‡∏ô‡∏ô‡∏≥

**Algorithm:**
1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏´‡∏°‡∏∏‡∏ô‡∏Ç‡∏≠‡∏á‡πÑ‡∏´‡∏•‡πà (angular velocity)
2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏´‡∏°‡∏∏‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏∞‡πÇ‡∏û‡∏Å
3. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏´‡∏•‡πà‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ 3 ‡πÄ‡∏ó‡πà‡∏≤ ‚Üí ‡πÑ‡∏´‡∏•‡πà‡∏ô‡∏≥ (‡∏ú‡∏¥‡∏î)

**Threshold:** `WAIST_SHOULDER_RATIO`: 3.0 (‡πÄ‡∏ó‡πà‡∏≤)

---

### 2.5 Rule 5: Vertical Stability (‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏ô‡∏¥‡πà‡∏á)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (ËôöÈ¢ÜÈ°∂Âä≤ - ‡∏ã‡∏ß‡∏µ‡πà‡∏´‡∏•‡∏¥‡∏á‡∏ï‡∏¥‡πà‡∏á‡∏à‡∏¥‡πâ‡∏ô):**
- ‡πÇ‡∏õ‡∏£‡∏á‡∏Å‡∏£‡∏∞‡∏´‡∏°‡πà‡∏≠‡∏°‡πÄ‡∏ö‡∏≤ ‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏á
- ‡πÑ‡∏°‡πà‡∏Å‡πâ‡∏°‡πÄ‡∏á‡∏¢‡∏Ç‡∏ì‡∏∞‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß

**Algorithm:**
1. ‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Y ‡∏Ç‡∏≠‡∏á‡∏à‡∏°‡∏π‡∏Å
2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡∏ô‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (std dev)
3. ‡∏ñ‡πâ‡∏≤ std > threshold ‚Üí ‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏Å‡∏£‡∏∞‡∏î‡∏Å

**Threshold:** `HEAD_MOVEMENT_THRESHOLD`: 0.02

---

### 2.6 Rule 6: Smoothness (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (Â¶ÇÊäΩ‰∏ù - ‡∏£‡∏π‡πä‡πÇ‡∏ä‡∏ß‡∏™‡∏∑‡∏≠):**
- ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏î‡∏∂‡∏á‡πÄ‡∏™‡πâ‡∏ô‡πÑ‡∏´‡∏°
- ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å

**Algorithm:**
1. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì acceleration ‡∏à‡∏≤‡∏Å velocity changes
2. ‡∏ñ‡πâ‡∏≤ acceleration ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‚Üí ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å

**Threshold:** `JERK_THRESHOLD`: 0.005

---

### 2.7 Rule 7: Continuity (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (ÁªµÁªµ‰∏çÊñ≠ - ‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ô‡πÄ‡∏´‡∏°‡∏µ‡∏¢‡∏ô‡∏õ‡∏π‡πâ‡∏ï‡πâ‡∏ß‡∏ô):**
- ‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏Ç‡∏≤‡∏î‡∏ï‡∏≠‡∏ô
- ‡πÑ‡∏°‡πà‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πà‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≤‡∏á

**Algorithm (Time-Based Average Velocity - v0.9.9):**
1. ‡πÉ‡∏ä‡πâ `isPaused()` helper method
2. Filter wristHistory ‡πÉ‡∏ô time window (2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì total distance traveled ‡πÉ‡∏ô window
4. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì avgVelocity = distance / timeSpan
5. ‡∏ñ‡πâ‡∏≤ avgVelocity < threshold ‚Üí ‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏¥‡πà‡∏á

**‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:** ‡πÉ‡∏ä‡πâ Time-Based ‡πÅ‡∏ó‡∏ô Frame-Based ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Skip Frame Logic ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏ö frames ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á

**Thresholds:**
- `PAUSE_WINDOW_MS`: 2000 (2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
- `PAUSE_AVG_VELOCITY_THRESHOLD`: 0.003

---


### 2.8 Rule 8: Weight Shift (‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å)

**‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£ (ÂàÜËôöÂÆû - ‡πÄ‡∏ü‡∏¥‡∏ô‡∏ã‡∏ß‡∏µ‡πà‡∏ã‡∏∑‡πà‡∏≠):**
- ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡πÅ‡∏¢‡∏Å‡πÄ‡∏ï‡πá‡∏°/‡∏ß‡πà‡∏≤‡∏á
- ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏à‡∏ô‡∏•‡πâ‡∏°

**Algorithm:**
1. ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤
2. ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏Å‡∏•‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡πÄ‡∏ó‡πâ‡∏≤ (‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤)
3. ‡∏ñ‡πâ‡∏≤‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‚Üí ‡πÄ‡∏™‡∏µ‡∏¢‡∏™‡∏°‡∏î‡∏∏‡∏•

**Threshold:** `WEIGHT_THRESHOLD`: 0.1

---

## 3. CONFIG Thresholds

```javascript
this.CONFIG = {
  // Rule 1: Path Shape
  CIRCLE_CONSISTENCY_THRESHOLD: 0.70,
  MIN_DIRECTION_SAMPLES: 10,
  
  // Rule 2: Arm Rotation
  ARM_ROTATION_THRESHOLD: 0.02,
  
  // Rule 3: Elbow Sinking
  ELBOW_THRESHOLD: 0.03,
  
  // Rule 4: Waist Initiation
  WAIST_SHOULDER_RATIO: 3.0,
  
  // Rule 5: Vertical Stability
  HEAD_MOVEMENT_THRESHOLD: 0.02,
  
  // Rule 6: Smoothness
  JERK_THRESHOLD: 0.005,
  
  // Rule 7: Continuity
  STOP_VELOCITY_THRESHOLD: 0.001,
  STOP_TIME_THRESHOLD: 500, // ms
  
  // Rule 8: Weight Shift
  WEIGHT_THRESHOLD: 0.1,
  
  // Feedback Display
  FEEDBACK_HOLD_TIME_MS: 1000,
  
  // History Settings
  WRIST_HISTORY_LENGTH: 30,
  HEAD_HISTORY_LENGTH: 15,
};
```

---

## 4. Methods Reference

### 4.1 Setup Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `setDebugMode(enabled)` | ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Debug Mode |
| `setLang(lang)` | ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏†‡∏≤‡∏©‡∏≤ ("th"/"en") |
| `setCalibration(data)` | ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Calibration |

### 4.2 Analysis Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `analyze(landmarks, timestamp, path, exercise, level)` | **Main** - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡πà‡∏≤ |
| `getDebugInfo()` | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Debug |
| `getMessage(key)` | ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Feedback ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤ |

### 4.3 Helper Methods

| Method | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|---------|
| `calculateDistance(p1, p2)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á 2 ‡∏à‡∏∏‡∏î |
| `getLineAngle(p1, p2)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á |
| `getAngularVelocity(a1, a2, dt)` | ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏ä‡∏¥‡∏á‡∏°‡∏∏‡∏° |

### 4.4 Rule Check Methods

| Method | Rule | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ |
|--------|------|---------|
| `checkPathShape(exercise)` | 1 | ‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏π‡∏õ‡∏ó‡∏£‡∏á‡∏ß‡∏á‡∏Å‡∏•‡∏° |
| `checkArmRotation(thumb, pinky, move)` | 2 | ‡∏ï‡∏£‡∏ß‡∏à‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÅ‡∏Ç‡∏ô |
| `checkElbowSinking(shoulder, elbow, wrist)` | 3 | ‡∏ï‡∏£‡∏ß‡∏à‡∏®‡∏≠‡∏Å‡∏à‡∏° |
| `checkWaistInitiation(landmarks, ts)` | 4 | ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏≠‡∏ß‡∏ô‡∏≥ |
| `checkVerticalStability(nose)` | 5 | ‡∏ï‡∏£‡∏ß‡∏à‡∏®‡∏µ‡∏£‡∏©‡∏∞‡∏ô‡∏¥‡πà‡∏á |
| `checkSmoothness(wrist, ts)` | 6 | ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏• |
| `checkContinuity()` | 7 | ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á |
| `checkWeightShift(lH, rH, lA, rA)` | 8 | ‡∏ï‡∏£‡∏ß‡∏à‡∏ñ‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å |

---

## 5. Level-based Rules

### ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏é‡∏ó‡∏µ‡πà active ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ Level

| Rule | L1 (‡∏ô‡∏±‡πà‡∏á) | L2 (‡∏¢‡∏∑‡∏ô) | L3 (‡∏¢‡∏∑‡∏ô‡∏¢‡πà‡∏≠) |
|------|:--------:|:--------:|:-----------:|
| 1. Path Shape | ‚úÖ | ‚úÖ | ‚úÖ |
| 2. Arm Rotation | ‚ùå | ‚úÖ | ‚úÖ |
| 3. Elbow Sinking | ‚úÖ | ‚úÖ | ‚úÖ |
| 4. Waist Initiation | ‚ùå | ‚úÖ | ‚úÖ |
| 5. Vertical Stability | ‚ùå | ‚úÖ | ‚úÖ |
| 6. Smoothness | ‚ùå | ‚ùå | ‚úÖ |
| 7. Continuity | ‚úÖ | ‚úÖ | ‚úÖ |
| 8. Weight Shift | ‚ùå | ‚ùå | ‚úÖ |

### Logic ‡πÉ‡∏ô analyze()

```javascript
const RULES_CONFIG = {
  L1: { checkPath: true, checkRotation: false, ... },
  L2: { checkPath: true, checkRotation: true, ... },
  L3: { checkPath: true, checkRotation: true, ... },
};

if (RULES_CONFIG[level].checkRotation) {
  result = this.checkArmRotation(...);
}
```

---

## üìö Related Files

- [SCRIPT_JS.md](SCRIPT_JS.md) - Main Controller
- [CALIBRATION_MANAGER.md](CALIBRATION_MANAGER.md) - Calibration
- [HEURISTICS_RULES_MANUAL.md](../HEURISTICS_RULES_MANUAL.md) - User Manual

---

*‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å code analysis ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥*
