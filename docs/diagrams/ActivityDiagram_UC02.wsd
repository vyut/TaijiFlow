@startuml TaijiFlow_Activity_Diagram_UC02
' ตั้งค่า Font และ Style
skinparam defaultFontName "sarabun"
skinparam activity {
    BackgroundColor White
    BorderColor Black
    ArrowColor Black
}

start

:ผู้ใช้งานเลือก "ท่าฝึก" และ "ระดับความยาก";

partition "System Initialization" {
    if (ตรวจสอบการเข้าถึงกล้อง?) then (ไม่ผ่าน (E1))
        :แสดงแจ้งเตือน "ไม่พบกล้อง/ไม่ได้รับอนุญาต";
        stop
    else (ผ่าน)
        :โหลดข้อมูลท่าต้นแบบ (JSON);
        if (พบไฟล์ข้อมูล?) then (ไม่พบ (E2))
            :แสดงแจ้งเตือน "ไม่พบข้อมูลต้นแบบ";
            stop
        else (พบ)
            :แสดงวิดีโอและเส้นนำทาง;
        endif
    endif
}

:ผู้ใช้กดปุ่ม Start Training;

partition "Calibration (<<include>> UC-01)" {
    :เริ่ม Calibration;
    :รอผู้ใช้ยืน T-Pose;
    :ตรวจสอบและบันทึกสัดส่วน;
    note right
        ดูรายละเอียดใน
        Activity Diagram UC-01
    end note
}

partition "Countdown & Start" {
    :แสดง Countdown 3-2-1;
    :แสดง Timer + Stop (มุมซ้ายล่าง);
    :แสดงปุ่ม Fullscreen (มุมขวาล่าง);
    :เริ่มนับเวลาฝึก (Timer);
}

partition "Main Training Loop (Real-time)" {
    repeat
        :รับภาพจากกล้อง (Frame Input);
        :ตรวจจับพิกัดร่างกาย (Pose Detection);
        
        partition "Heuristics Analysis" {
            :ตรวจสอบตามกฎ 8 ข้อ (ตาม Level);
            note right
                ดูรายละเอียดใน
                ActivityDiagram_Heuristics.wsd
            end note
        }

        if (พบข้อผิดพลาด?) then (ใช่)
            :แสดง Feedback (ข้อความ/สีแดง);
            :ส่งเสียงแจ้งเตือน (Audio);
        else (ไม่ใช่)
            :แสดงผลปกติ (สีเขียว);
        endif

        :บันทึกคะแนนและข้อมูลเฟรม (Logging);

    repeat while (ผู้ใช้กดหยุด หรือ หมดเวลา?) is (ไม่)
    -> ใช่ (Stop/Timeout);
}

:ออกจาก Fullscreen (ถ้าอยู่);
:ส่งข้อมูลไป UC-03 (View Result);

stop
@enduml
