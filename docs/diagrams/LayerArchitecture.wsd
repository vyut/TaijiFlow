@startuml LayerArchitecture
' ============================================================================
' TaijiFlow AI - Layer Architecture Diagram
' ============================================================================
' ‡πÅ‡∏™‡∏î‡∏á 4 Layer ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö: Presentation, Business Logic, Data, External APIs
' ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£: ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Layer ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö Layer ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
' ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: 2026-01-08
' ============================================================================

skinparam defaultFontName "Sarabun"
skinparam backgroundColor transparent
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam linetype ortho

' === Direction ===
top to bottom direction

' === Colors ===
skinparam package {
    BackgroundColor<<presentation>> #E3F2FD
    BackgroundColor<<business>> #FFF3E0
    BackgroundColor<<data>> #E8F5E9
    BackgroundColor<<external>> #FFEBEE
    BorderColor #666666
}

skinparam component {
    BackgroundColor #FFFFFF
    BorderColor #999999
}

' ============================================================================
' LAYER 1: PRESENTATION LAYER (Top)
' ============================================================================

package "üñ•Ô∏è PRESENTATION LAYER" <<presentation>> {
    [index.html] as IndexHtml
    [ui_manager.js] as UIManager
    [drawing_manager.js] as DrawingManager
    [tutorial_manager.js] as TutorialManager
    [score_popup_manager.js] as ScorePopup
    [chatbot.js] as Chatbot
    [feedback_manager.js] as FeedbackManager
    [lighting_manager.js] as Lighting
    [debug_manager.js] as Debug
    [wisdom_manager.js] as Wisdom
    [shortcuts_manager.js] as Shortcuts
    [webgl_manager.js] as WebGL
}

' ============================================================================
' LAYER 2: BUSINESS LOGIC LAYER
' ============================================================================

package "‚öôÔ∏è BUSINESS LOGIC LAYER" <<business>> {
    [script.js] as Script
    [heuristics_engine.js] as Heuristics
    [calibration_manager.js] as Calibration
    [scoring_manager.js] as Scoring
    [gesture_manager.js] as Gesture
    [audio_manager.js] as Audio
    [camera_manager.js] as Camera
    [performance_monitor.js] as PerfMon
}

' ============================================================================
' LAYER 3: DATA LAYER
' ============================================================================

package "üíæ DATA LAYER" <<data>> {
    [session_manager.js] as Session
    [data_exporter.js] as Exporter
    [LocalStorage] as LocalStorage
    [path_generator.js] as PathGen
    [translations.js] as Translations
    [i18n_manager.js] as I18n
    [time_utils.js] as TimeUtils
    [math_utils.js] as MathUtils
}

' ============================================================================
' LAYER 4: EXTERNAL APIs (Bottom)
' ============================================================================

package "üåê EXTERNAL APIs" <<external>> {
    [MediaPipe Pose] as MPPose
    [MediaPipe Gesture] as MPGesture
    [Web Speech API] as WebSpeech
    [Gemini API] as Gemini
}

' ============================================================================
' RELATIONSHIPS (Layer-to-Layer Communication Only)
' ============================================================================

' Presentation ‚Üí Business Logic
UIManager --> Script : ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
DrawingManager --> Heuristics : ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
ScorePopup --> Scoring : ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
TutorialManager --> Script : ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°
Shortcuts --> Script : ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
Lighting --> Script : ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏™‡∏á
Debug --> PerfMon : ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ FPS
Wisdom --> Script : ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏Ñ‡∏°
FeedbackManager --> Script : ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤

' Business Logic ‚Üí Data
Script --> Session : ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ session
Script --> Exporter : ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
Script --> PathGen : ‡∏™‡∏£‡πâ‡∏≤‡∏á path
Script --> TimeUtils : ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤
Heuristics --> MathUtils : ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
UIManager --> I18n : ‡πÅ‡∏õ‡∏•‡∏†‡∏≤‡∏©‡∏≤
I18n --> Translations : ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

' Business Logic ‚Üí External APIs
Heuristics --> MPPose : ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ó‡πà‡∏≤
Camera --> MPPose : ‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û
Gesture --> MPGesture : ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠
Audio --> WebSpeech : ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
Chatbot --> Gemini : AI ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°

' Data ‚Üí LocalStorage
Session --> LocalStorage : ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡∏≠‡πà‡∏≤‡∏ô
I18n --> LocalStorage : ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏©‡∏≤

' Internal Layer Connections (Helpers)
Script --> Calibration : ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
Script --> PerfMon : ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Perf
Script --> Camera : ‡∏Ñ‡∏∏‡∏°‡∏Å‡∏•‡πâ‡∏≠‡∏á
Script --> Audio : ‡∏û‡∏π‡∏î‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
WebGL --> DrawingManager : Render


' ============================================================================
' LEGEND
' ============================================================================

legend right
  |= Layer |= ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å |
  | Presentation | ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• UI, ‡∏£‡∏±‡∏ö input |
  | Business Logic | ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•, ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå |
  | Data | ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• |
  | External APIs | ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å |
  --
  **üí° ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£:** ‡πÅ‡∏ï‡πà‡∏•‡∏∞ Layer ‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏Å‡∏±‡∏ö Layer ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
endlegend

@enduml
