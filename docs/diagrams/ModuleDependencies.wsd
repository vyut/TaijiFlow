@startuml ModuleDependencies
' ============================================================================
' TaijiFlow AI - Module Dependencies Diagram (Top-Down Layers)
' ============================================================================
' แสดงความสัมพันธ์ระหว่าง 22 Modules แบ่งเป็น 5 ชั้น
' อัปเดต: 2026-01-12 (Refined Layout)
' ============================================================================

skinparam defaultFontName "Sarabun"
skinparam backgroundColor transparent
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam linetype ortho
skinparam nodesep 0.8
skinparam ranksep 1.0

' === Direction ===
top to bottom direction

' === Colors ===
skinparam package {
    BackgroundColor<<entry>> #E3F2FD
    BackgroundColor<<core>> #FFF3E0
    BackgroundColor<<display>> #E0F7FA
    BackgroundColor<<ui>> #E8F5E9
    BackgroundColor<<controller>> #E1BEE7
    BackgroundColor<<utility>> #F3E5F5
    BackgroundColor<<external>> #FFEBEE
}

' ============================================================================
' LAYER 1: ENTRY POINT
' ============================================================================

package "Layer 1: Entry Point" <<entry>> {
    [script.js] as Script
}

' ============================================================================
' LAYER 2: CONTROLLERS
' ============================================================================

package "Layer 2: Controllers" <<controller>> {
    [DisplayController] as DisplayCtrl
    [KeyboardController] as KeyboardCtrl
}

' ============================================================================
' LAYER 3: MANAGERS (Core + Display + UI)
' ============================================================================

package "Layer 3: Display Managers" <<display>> {
    [DrawingManager] as Drawing
    [GhostManager] as Ghost
    [BackgroundManager] as Background
    [WebGLManager] as WebGL
}

package "Layer 3: Core Managers" <<core>> {
    [HeuristicsEngine] as Heuristics
    [CalibrationManager] as Calibration
    [ScoringManager] as Scoring
    [CameraManager] as Camera
    [PerformanceMonitor] as PerfMon
}

package "Layer 3: UI Managers" <<ui>> {
    ' Row 1: Core UI & Interaction
    [UIManager] as UI
    [ShortcutsManager] as Shortcuts
    [GestureManager] as Gesture
    [AudioManager] as Audio

    ' Row 2: Popups & Overlays
    [ScorePopupManager] as ScorePopup
    [TutorialManager] as Tutorial
    [FeedbackManager] as Feedback
    [WisdomManager] as Wisdom

    ' Row 3: Tools & Settings
    [RulesConfigManager] as RulesConfig
    [LightingManager] as Lighting
    [DebugManager] as Debug
    [Chatbot] as Chatbot

    ' Force 3 rows layout
    UI -[hidden]-> ScorePopup
    ScorePopup -[hidden]-> RulesConfig
}

' ============================================================================
' LAYER 4: UTILITIES
' ============================================================================

package "Layer 4: Utilities" <<utility>> {
    ' Row 1: Data & Session
    [SessionManager] as Session
    [DataExporter] as Exporter
    [I18nManager] as I18n
    [translations.js] as Translations

    ' Row 2: Logic & Helpers
    [PathGenerator] as PathGen
    [TimeUtils] as TimeUtils
    [MathUtils] as MathUtils

    ' Force Layout
    Session -[hidden]-> PathGen
}

package "Layer 4: Landing Page" <<utility>> {
    [silk-animation.js] as SilkAnim
}

' ============================================================================
' LAYER 5: EXTERNAL APIs
' ============================================================================

package "Layer 5: External APIs" <<external>> {
    [MediaPipe Pose] as MPPose
    [MediaPipe Gesture] as MPGesture
    [Web Speech API] as WebSpeech
    [Gemini API] as Gemini
}

' ============================================================================
' LAYOUT HELPER (Hidden Links for Sequencing)
' ============================================================================
' Force vertical ordering
Script -[hidden]-> DisplayCtrl
DisplayCtrl -[hidden]-> Heuristics
Heuristics -[hidden]-> Exporter
Exporter -[hidden]-> MPPose

' Force horizontal alignment for Layer 3 (Display - Core - UI)
Drawing -[hidden]- Heuristics
Heuristics -[hidden]- UI

' Force horizontal alignment for Layer 4
Exporter -[hidden]- SilkAnim

' ============================================================================
' RELATIONSHIPS (Main flows)
' ============================================================================

' Layer 1 → Layer 2
Script --> DisplayCtrl
Script --> KeyboardCtrl

' Layer 1 → Layer 3 (Core)
Script --> Heuristics
Script --> Calibration
Script --> Scoring
Script --> Camera
Script --> PerfMon

' Layer 1 → Layer 3 (Display)
Script --> Drawing
Script --> Ghost
Script --> WebGL

' Layer 1 → Layer 3 (UI)
Script --> UI
Script --> Audio
Script --> Gesture
Script --> Lighting
Script --> Debug
Script --> Shortcuts

' Layer 2 → Layer 3
DisplayCtrl --> Ghost
DisplayCtrl --> Background
KeyboardCtrl --> Tutorial
KeyboardCtrl --> Shortcuts

' Layer 3 Internal
RulesConfig --> Heuristics
UI --> I18n
I18n --> Translations
Feedback --> UI : Reads State (Window)
Feedback --> I18n
ScorePopup --> I18n
Debug --> PerfMon : Reads FPS
Wisdom --> I18n

' Core → Utilities
Heuristics --> MathUtils
Scoring --> MathUtils

' Layer 3 → Layer 5 (External)
Heuristics --> MPPose
Camera --> MPPose
Gesture --> MPGesture
Audio --> WebSpeech
Chatbot --> Gemini


' Layer 1 → Layer 4 (Utilities)
Script ..> Exporter
Script ..> PathGen
Script ..> Session
Script ..> TimeUtils

@enduml
