@startuml StateDiagram_TrainingSession
' ============================================================================
' TaijiFlow AI - State Diagram: Training Session
' ============================================================================
' ‡πÅ‡∏™‡∏î‡∏á States ‡πÅ‡∏•‡∏∞ Transitions ‡∏Ç‡∏≠‡∏á Training Session
' ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: script.js (isTrainingMode, isRecording, calibrator.isActive)
' ============================================================================

skinparam defaultFontName "Sarabun"
skinparam backgroundColor transparent
skinparam state {
    BackgroundColor #FAFAFA
    BorderColor #424242
    FontColor #212121
    ArrowColor #424242
}

' === State Colors ===
skinparam state {
    BackgroundColor<<idle>> #E3F2FD
    BackgroundColor<<calibrating>> #FFF3E0
    BackgroundColor<<countdown>> #E8F5E9
    BackgroundColor<<training>> #E8F5E9
    BackgroundColor<<ended>> #F3E5F5
}

' ============================================================================
' STATES
' ============================================================================

[*] --> PrivacyModal

state "PrivacyModal\n(‡πÅ‡∏™‡∏î‡∏á Privacy + Warning)" as PrivacyModal <<idle>> {
    PrivacyModal : ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
    PrivacyModal : ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
    PrivacyModal : ‡∏£‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß"
}

state "MobileCheck\n(‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå)" as MobileCheck <<idle>> {
    MobileCheck : ‡∏ï‡∏£‡∏ß‡∏à User Agent
    MobileCheck : ‡∏ï‡∏£‡∏ß‡∏à Screen Width
    MobileCheck : isMobilePhone()?
}

state "MobileWarning\n(‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)" as MobileWarning <<idle>> {
    MobileWarning : ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    MobileWarning : "‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å"
    MobileWarning : "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ ‚Üí"
}

state "Idle\n(‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å)" as Idle <<idle>> {
    Idle : isTrainingMode = false
    Idle : isRecording = false
    Idle : calibrator.isActive = false
    Idle : Camera Active ‚úì
}

state "Calibrating\n(‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö T-Pose)" as Calibrating <<calibrating>> {
    Calibrating : isTrainingMode = false
    Calibrating : calibrator.isActive = true
    Calibrating : ---
    Calibrating : ‡∏ï‡∏£‡∏ß‡∏à visibility
    Calibrating : ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡πà‡∏≤ T-Pose
    Calibrating : ‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
}

state "Countdown\n(‡∏ô‡∏±‡∏ö‡∏ñ‡∏≠‡∏¢‡∏´‡∏•‡∏±‡∏á 3-2-1)" as Countdown <<countdown>> {
    Countdown : showCountdown()
    Countdown : ‡πÅ‡∏™‡∏î‡∏á overlay "3-2-1"
}

state "Training\n(‡∏ù‡∏∂‡∏Å‡∏ó‡πà‡∏≤‡∏°‡πâ‡∏ß‡∏ô‡πÑ‡∏´‡∏°)" as Training <<training>> {
    Training : isTrainingMode = true
    Training : isRecording = true
    Training : ---
    Training : ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡πà‡∏≤ (8 ‡∏Å‡∏é)
    Training : ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å landmarks
    Training : ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
    Training : Timer ‡∏ô‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤
}

state "Ended\n(‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)" as Ended <<ended>> {
    Ended : isTrainingMode = false
    Ended : ‡πÅ‡∏™‡∏î‡∏á Score Popup
    Ended : Export Session Data
}

' ============================================================================
' TRANSITIONS
' ============================================================================

PrivacyModal --> MobileCheck : ‡∏Å‡∏î "‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß"
note on link
    initCamera()
    getUserMedia()
end note

MobileCheck --> MobileWarning : [isMobilePhone = true]
MobileCheck --> Idle : [isMobilePhone = false]\nCamera Ready

MobileWarning --> Idle : "‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠ ‚Üí"
note on link
    ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
end note

MobileWarning --> [*] : "‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å"
note on link
    window.location = "index.html"
end note

Idle --> Calibrating : ‡∏Å‡∏î Start /\n‡∏¢‡∏Å‡∏ô‡∏¥‡πâ‡∏ß‡πÇ‡∏õ‡πâ‡∏á üëç
note on link
    startTrainingFlow()
    calibrator.start()
end note

Calibrating --> Countdown : Calibration Complete\n(Time >= 3000ms)
note on link
    calibrator.process()
    returns {status: "complete"}
end note

Calibrating --> Idle : ‡∏Å‡∏î Cancel /\n‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤
note on link
    calibrator.cancel()
end note

Countdown --> Training : Countdown ‡πÄ‡∏™‡∏£‡πá‡∏à
note on link
    startTrainingAfterCalibration()
    isTrainingMode = true
    isRecording = true
end note

Training --> Ended : ‡∏Å‡∏î Stop /\n‡∏Å‡∏≥‡∏°‡∏∑‡∏≠ ‚úä /\n‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ 5 ‡∏ô‡∏≤‡∏ó‡∏µ
note on link
    endTrainingSession()
    scorer.getSummary()
end note

Ended --> Idle : ‡∏õ‡∏¥‡∏î Score Popup\n(3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
note on link
    resetToHomeScreen()
end note

Idle --> Idle : ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡πà‡∏≤ / Level
Training --> Training : Camera 30 FPS\nAI 7.5 FPS (Throttled)

@enduml
