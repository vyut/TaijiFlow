# à¸ à¸²à¸„à¸œà¸™à¸§à¸ à¸‡: à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸—à¹ˆà¸²à¸—à¸²à¸‡ (Heuristics Engine Algorithm Manual)

> **à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰:** à¸­à¸˜à¸´à¸šà¸²à¸¢à¸­à¸±à¸¥à¸à¸­à¸£à¸´à¸—à¸¶à¸¡à¸à¸²à¸£à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸—à¹ˆà¸²à¸—à¸²à¸‡ 9 à¸‚à¹‰à¸­à¹ƒà¸™ TaijiFlow AI à¸­à¸¢à¹ˆà¸²à¸‡à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
> à¸à¸£à¹‰à¸­à¸¡ Flowcharts, Source Code, à¸«à¸¥à¸±à¸à¸à¸²à¸£à¹„à¸—à¹ˆà¹€à¸à¹Šà¸ à¹à¸¥à¸°à¸•à¸²à¸£à¸²à¸‡ CONFIG

---

## à¸‡.1 à¸à¸²à¸£à¸ˆà¸±à¸”à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¸à¸ 9 à¸‚à¹‰à¸­

### à¹€à¸«à¸•à¸¸à¸œà¸¥à¸à¸²à¸£à¸ˆà¸±à¸”à¹€à¸£à¸µà¸¢à¸‡à¸¥à¸³à¸”à¸±à¸š

à¸à¸ 9 à¸‚à¹‰à¸­à¸–à¸¹à¸à¸ˆà¸±à¸”à¹€à¸£à¸µà¸¢à¸‡à¸•à¸²à¸¡ **à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆà¸‚à¸­à¸‡à¸«à¸¥à¸±à¸à¹„à¸—à¹ˆà¸ˆà¸µà¹‹** à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸•à¸²à¸¡à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸¢à¸²à¸ (Level) à¹€à¸à¸·à¹ˆà¸­:

1. **à¸„à¸§à¸²à¸¡à¸ªà¸­à¸”à¸„à¸¥à¹‰à¸­à¸‡à¸à¸±à¸šà¸«à¸¥à¸±à¸à¸à¸²à¸£à¹„à¸—à¹ˆà¸ˆà¸µà¹‹** - à¸à¸à¹ƒà¸™à¸«à¸¡à¸§à¸”à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¸¡à¸µà¸„à¸§à¸²à¸¡à¹€à¸à¸µà¹ˆà¸¢à¸§à¸‚à¹‰à¸­à¸‡à¸à¸±à¸™
2. **à¸„à¸§à¸²à¸¡à¸ªà¸°à¸”à¸§à¸à¹ƒà¸™à¸à¸²à¸£à¸šà¸³à¸£à¸¸à¸‡à¸£à¸±à¸à¸©à¸²** - à¹à¸à¹‰à¹„à¸‚/à¹€à¸à¸´à¹ˆà¸¡à¸à¸à¹ƒà¸™à¸«à¸¡à¸§à¸”à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¹„à¸”à¹‰à¸‡à¹ˆà¸²à¸¢
3. **à¸„à¸§à¸²à¸¡à¸¢à¸·à¸”à¸«à¸¢à¸¸à¹ˆà¸™** - à¸à¸à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™à¸ªà¸²à¸¡à¸²à¸£à¸–à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸«à¸¥à¸²à¸¢ Level (à¸”à¸¹ à¸‡.11)

### à¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ

![Heuristics Rule Categories](../../out/docs/diagrams/HeuristicsRuleCategories/HeuristicsRuleCategories.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    à¸à¸²à¸£à¸ˆà¸±à¸”à¸«à¸¡à¸§à¸”à¸«à¸¡à¸¹à¹ˆ 9 à¸à¸                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ à¸«à¸¡à¸§à¸”à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡ (Path)                                          â”‚
â”‚      Rule 1: Path Shape       - à¸£à¸¹à¸›à¸—à¸£à¸‡à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡ (åœ†è½¬å¦‚æ„)          â”‚
â”‚                                                                  â”‚
â”‚  ğŸ¦´ à¸«à¸¡à¸§à¸”à¸—à¹ˆà¸²à¸—à¸²à¸‡ (Posture)                                         â”‚
â”‚      Rule 2: Arm Rotation     - à¸à¸²à¸£à¸«à¸¡à¸¸à¸™à¹à¸‚à¸™ (æ—‹è…•è½¬è‡‚)            â”‚
â”‚      Rule 3: Elbow Sinking    - à¸¨à¸­à¸à¸ˆà¸¡ (æ²‰è‚©å è‚˜)                 â”‚
â”‚      Rule 4: Waist Initiation - à¹€à¸­à¸§à¸™à¸³ (è…°ä¸ºè½´)                   â”‚
â”‚      Rule 5: Vertical Stability - à¸¨à¸µà¸£à¸©à¸°à¸™à¸´à¹ˆà¸‡ (è™šé¢†é¡¶åŠ²)           â”‚
â”‚                                                                  â”‚
â”‚  ğŸŒŠ à¸«à¸¡à¸§à¸”à¸ªà¹„à¸•à¸¥à¹Œ (Movement Quality)                                â”‚
â”‚      Rule 6: Smoothness       - à¸„à¸§à¸²à¸¡à¸¥à¸·à¹ˆà¸™à¹„à¸«à¸¥ (å¦‚æŠ½ä¸)             â”‚
â”‚      Rule 7: Continuity       - à¸„à¸§à¸²à¸¡à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡ (ç»µç»µä¸æ–­)          â”‚
â”‚                                                                  â”‚
â”‚  âš–ï¸ à¸«à¸¡à¸§à¸”à¸™à¹‰à¸³à¸«à¸™à¸±à¸ (Weight Distribution)                           â”‚
â”‚      Rule 8: Weight Shift     - à¸–à¹ˆà¸²à¸¢à¸™à¹‰à¸³à¸«à¸™à¸±à¸ (åˆ†è™šå®)             â”‚
â”‚      Rule 9: Coordination     - à¸šà¸™à¸¥à¹ˆà¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œ (ä¸Šä¸‹ç›¸éš)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸:** à¹à¸•à¹ˆà¸¥à¸° Level à¸ˆà¸°à¹€à¸›à¸´à¸”/à¸›à¸´à¸”à¸à¸à¸•à¸²à¸¡ `RULES_CONFIG` à¹„à¸¡à¹ˆà¸ˆà¸³à¹€à¸›à¹‡à¸™à¸•à¹‰à¸­à¸‡à¹ƒà¸Šà¹‰à¸—à¸¸à¸à¸à¸
> (à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¹ƒà¸™ à¸‡.12 Level Configuration)

---

## à¸‡.2 à¸ à¸²à¸à¸£à¸§à¸¡ 9 à¸à¸ Heuristics

| à¸à¸ | à¸Šà¸·à¹ˆà¸­ | à¸«à¸¥à¸±à¸à¸à¸²à¸£à¸ˆà¸µà¸™ | à¸„à¸§à¸²à¸¡à¸«à¸¡à¸²à¸¢ |
|:--:|------|:----------:|----------|
| 1 | Path Shape | åœ†è½¬å¦‚æ„ | à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¹€à¸›à¹‡à¸™à¸§à¸‡à¸à¸¥à¸¡ |
| 2 | Arm Rotation | æ—‹è…•è½¬è‡‚ | à¸«à¸¡à¸¸à¸™à¸à¹ˆà¸²à¸¡à¸·à¸­à¸–à¸¹à¸à¸—à¸´à¸¨ |
| 3 | Elbow Sinking | æ²‰è‚©å è‚˜ | à¸¨à¸­à¸à¸ˆà¸¡ |
| 4 | Waist Initiation | è…°ä¸ºè½´ | à¹€à¸­à¸§à¸™à¸³ |
| 5 | Vertical Stability | è™šé¢†é¡¶åŠ² | à¸¨à¸µà¸£à¸©à¸°à¸™à¸´à¹ˆà¸‡ |
| 6 | Smoothness | å¦‚æŠ½ä¸ | à¸¥à¸·à¹ˆà¸™à¹„à¸«à¸¥ |
| 7 | Continuity | ç»µç»µä¸æ–­ | à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡ |
| 8 | Weight Shift | åˆ†è™šå® | à¸™à¹‰à¸³à¸«à¸™à¸±à¸à¹ƒà¸™à¸à¸²à¸™ |
| 9 | Coordination | ä¸Šä¸‹ç›¸éš | à¸šà¸™à¸¥à¹ˆà¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸™ |

---

## à¸‡.3 Rule 1: Path Accuracy (Shape-Based)

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸§à¸²à¸”à¹€à¸›à¹‡à¸™à¸§à¸‡à¹‚à¸„à¹‰à¸‡** à¹à¸¥à¸° **à¸«à¸¡à¸¸à¸™à¸–à¸¹à¸à¸—à¸´à¸¨à¸—à¸²à¸‡** à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ

### Implementation Notes (v0.9.10)

> **à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ˆà¸²à¸ Position-Based à¹€à¸›à¹‡à¸™ Shape-Based**
> 
> à¹€à¸”à¸´à¸¡: à¸§à¸±à¸”à¸£à¸°à¸¢à¸°à¸«à¹ˆà¸²à¸‡à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸·à¸­à¸à¸±à¸š Ghost/Reference Path
> 
> à¹ƒà¸«à¸¡à¹ˆ: à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸§à¹ˆà¸²à¹€à¸ªà¹‰à¸™à¸—à¸²à¸‡à¸—à¸µà¹ˆà¸§à¸²à¸”à¹€à¸›à¹‡à¸™à¸§à¸‡à¸à¸¥à¸¡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ + à¸•à¸£à¸§à¸ˆà¸—à¸´à¸¨à¸—à¸²à¸‡à¸«à¸¡à¸¸à¸™
> 
> **à¹€à¸«à¸•à¸¸à¸œà¸¥:** à¸ªà¸­à¸”à¸„à¸¥à¹‰à¸­à¸‡à¸à¸±à¸šà¸«à¸¥à¸±à¸à¸—à¹ˆà¸²à¸¡à¹‰à¸§à¸™à¹„à¸«à¸¡à¸—à¸µà¹ˆà¸­à¸™à¸¸à¸à¸²à¸•à¹ƒà¸«à¹‰à¸‚à¸™à¸²à¸”à¸§à¸‡à¸à¸¥à¸¡à¹à¸¥à¸°à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™à¹„à¸”à¹‰

> **ğŸ†• v0.9.10: Slice-Based à¹à¸—à¸™ Time-Based**
> 
> à¹ƒà¸Šà¹‰ 10 à¸ˆà¸¸à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸” (slice-based) à¹à¸—à¸™ time window à¹€à¸à¸£à¸²à¸° timestamps à¹„à¸¡à¹ˆà¹€à¸Šà¸·à¹ˆà¸­à¸–à¸·à¸­à¹„à¸”à¹‰
> à¹€à¸à¸´à¹ˆà¸¡ `isPaused()` check à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰ Rule 7 à¸ˆà¸±à¸”à¸à¸²à¸£à¸à¸²à¸£à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡
> à¸•à¸£à¸§à¸ˆà¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¹ˆà¸­à¸™ consistency à¹€à¸à¸£à¸²à¸°à¸ªà¸³à¸„à¸±à¸à¸à¸§à¹ˆà¸²

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 1: Path Shape Flowchart](../../out/docs/diagrams/HeuristicsRule1_PathShape/HeuristicsRule1_PathShape.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkPathShape(currentExercise)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™                               â”‚
â”‚ - à¸•à¹‰à¸­à¸‡à¸¡à¸µ wristHistory à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 10 points                    â”‚
â”‚ â†’ à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸à¸­: return null (à¸£à¸­à¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸´à¹ˆà¸¡)                   â”‚
â”‚ - à¸–à¹‰à¸² isPaused() = true â†’ return null (à¹ƒà¸«à¹‰ Rule 7 à¸ˆà¸±à¸”à¸à¸²à¸£)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸„à¸³à¸™à¸§à¸“ Direction Consistency                        â”‚
â”‚                                                             â”‚
â”‚   à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸¸à¸ 3 à¸ˆà¸¸à¸”à¸•à¸´à¸”à¸à¸±à¸™ (p1, p2, p3):                        â”‚
â”‚     cross = (p2-p1) Ã— (p3-p2)  (Cross Product)             â”‚
â”‚                                                             â”‚
â”‚     à¸–à¹‰à¸² cross > 0.0001 â†’ clockwiseTurns++                   â”‚
â”‚     à¸–à¹‰à¸² cross < -0.0001 â†’ counterClockwiseTurns++           â”‚
â”‚                                                             â”‚
â”‚   consistency = max(CW, CCW) / (CW + CCW)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸•à¸£à¸§à¸ˆà¸§à¹ˆà¸²à¹€à¸›à¹‡à¸™à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ (ğŸ†• v0.9.10)              â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² total == 0 (à¹„à¸¡à¹ˆà¸¡à¸µ CW à¸«à¸£à¸·à¸­ CCW à¹€à¸¥à¸¢)                     â”‚
â”‚     â†’ "âš ï¸ à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸¡à¸·à¸­à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸§à¸‡à¹‚à¸„à¹‰à¸‡" (à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡!)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 4: à¸•à¸£à¸§à¸ˆà¸—à¸´à¸¨à¸—à¸²à¸‡à¸«à¸¡à¸¸à¸™ **à¸à¹ˆà¸­à¸™** (ğŸ†• à¸ªà¸³à¸„à¸±à¸à¸à¸§à¹ˆà¸² consistency)  â”‚
â”‚                                                             â”‚
â”‚   expectedCW = à¸—à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¸¡à¸µ "cw" à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ                      â”‚
â”‚   actualCW = counterClockwiseTurns > clockwiseTurns         â”‚
â”‚   (à¸ªà¸¥à¸±à¸šà¹€à¸à¸£à¸²à¸°à¸§à¸´à¸”à¸µà¹‚à¸­ Mirror)                                    â”‚
â”‚                                                             â”‚
â”‚   dominance = max(CW, CCW) / total                          â”‚
â”‚   à¸–à¹‰à¸² dominance >= 0.6 AND expectedCW â‰  actualCW            â”‚
â”‚     â†’ "âš ï¸ à¸«à¸¡à¸¸à¸™à¸¡à¸·à¸­à¸œà¸´à¸”à¸—à¸´à¸¨à¸—à¸²à¸‡"                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 5: à¸•à¸£à¸§à¸ˆ Consistency                                   â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² consistency < 0.6 (60%)                               â”‚
â”‚     â†’ "âš ï¸ à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸¡à¸·à¸­à¹ƒà¸«à¹‰à¹€à¸›à¹‡à¸™à¸§à¸‡à¹‚à¸„à¹‰à¸‡"                          â”‚
â”‚   à¸–à¹‰à¸²à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ â†’ null                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸ Cross Product

```
   Cross Product à¹ƒà¸Šà¹‰à¸•à¸£à¸§à¸ˆà¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¸²à¸£à¸«à¸¡à¸¸à¸™
   
   p1 â”€â”€â†’ p2 â”€â”€â†’ p3
   
   Cross = (p2.x - p1.x) Ã— (p3.y - p2.y) 
         - (p2.y - p1.y) Ã— (p3.x - p2.x)
   
   à¹ƒà¸™ Screen Coordinates (Y à¸à¸¥à¸±à¸šà¸«à¸±à¸§):
   Cross > 0 = à¸«à¸¡à¸¸à¸™à¸•à¸²à¸¡à¹€à¸‚à¹‡à¸¡ (CW)
   Cross < 0 = à¸«à¸¡à¸¸à¸™à¸—à¸§à¸™à¹€à¸‚à¹‡à¸¡ (CCW)
```

### à¹‚à¸„à¹‰à¸” (v0.9.10)

```javascript
checkPathShape(currentExercise = "rh_cw") {
  const threshold = this.CONFIG.SHAPE_CONSISTENCY_THRESHOLD; // 0.6
  const analysisPoints = this.CONFIG.SHAPE_ANALYSIS_POINTS;  // 10 (slice-based)

  // à¸•à¹‰à¸­à¸‡à¸¡à¸µ points à¹€à¸à¸µà¸¢à¸‡à¸à¸­à¸à¹ˆà¸­à¸™à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ
  if (this.wristHistory.length < analysisPoints) return null;

  // ğŸ†• à¸–à¹‰à¸²à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡ à¹ƒà¸«à¹‰à¸‚à¹‰à¸²à¸¡ Rule 1 à¹à¸¥à¸°à¸›à¸¥à¹ˆà¸­à¸¢à¹ƒà¸«à¹‰ Rule 7 (Continuity) à¸ˆà¸±à¸”à¸à¸²à¸£
  if (this.isPaused()) return null;

  // ğŸ†• Slice-Based: à¹ƒà¸Šà¹‰ N à¸ˆà¸¸à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸” (à¸‡à¹ˆà¸²à¸¢à¸à¸§à¹ˆà¸² time-based à¹à¸¥à¸°à¹€à¸Šà¸·à¹ˆà¸­à¸–à¸·à¸­à¹„à¸”à¹‰)
  const recentHistory = this.wristHistory.slice(-analysisPoints);

  let clockwiseTurns = 0, counterClockwiseTurns = 0;

  for (let i = 2; i < recentHistory.length; i++) {
    const p1 = recentHistory[i - 2];
    const p2 = recentHistory[i - 1];
    const p3 = recentHistory[i];
    const cross = (p2.x - p1.x) * (p3.y - p2.y) - (p2.y - p1.y) * (p3.x - p2.x);

    if (cross > 0.0001) clockwiseTurns++;
    else if (cross < -0.0001) counterClockwiseTurns++;
  }

  const total = clockwiseTurns + counterClockwiseTurns;

  // ğŸ†• Fix: à¸–à¹‰à¸² total = 0 à¹à¸›à¸¥à¸§à¹ˆà¸²à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¹€à¸ªà¹‰à¸™à¸•à¸£à¸‡ â†’ à¹à¸ˆà¹‰à¸‡à¹€à¸•à¸·à¸­à¸™
  if (total === 0) {
    return this.getMessage("moveInCircle");
  }

  const consistency = Math.max(clockwiseTurns, counterClockwiseTurns) / total;

  // ğŸ†• à¸•à¸£à¸§à¸ˆà¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¹ˆà¸­à¸™ (à¸ªà¸³à¸„à¸±à¸à¸à¸§à¹ˆà¸² consistency)
  const expectedCW = currentExercise.includes("cw");
  const actualCW = counterClockwiseTurns > clockwiseTurns; // à¸ªà¸¥à¸±à¸šà¹€à¸à¸£à¸²à¸° mirror

  // à¸•à¸£à¸§à¸ˆà¸—à¸´à¸¨à¸—à¸²à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µ turn à¸Šà¸±à¸”à¹€à¸ˆà¸™ (dominance >= 60%)
  const dominance = Math.max(clockwiseTurns, counterClockwiseTurns) / total;
  if (dominance >= 0.6 && expectedCW !== actualCW) {
    return this.getMessage("wrongDirection");
  }

  // à¸•à¸±à¸”à¸ªà¸´à¸™: à¸–à¹‰à¸² consistency à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² threshold = à¹„à¸¡à¹ˆà¹€à¸›à¹‡à¸™à¸§à¸‡à¹‚à¸„à¹‰à¸‡
  if (consistency < threshold) {
    return this.getMessage("moveInCircle");
  }

  return null;
}
```

### CONFIG

| Parameter | à¸„à¹ˆà¸² | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|-----------|-----|----------|
| `SHAPE_CONSISTENCY_THRESHOLD` | 0.6 | 60% à¸‚à¸¶à¹‰à¸™à¹„à¸› = à¹€à¸›à¹‡à¸™à¸§à¸‡à¹‚à¸„à¹‰à¸‡ |
| `SHAPE_ANALYSIS_POINTS` | 10 | ğŸ†• à¹ƒà¸Šà¹‰ 10 à¸ˆà¸¸à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸” (slice-based) |

### à¸‚à¹‰à¸­à¸”à¸µà¸‚à¸­à¸‡ Shape-Based

| à¹€à¸”à¸´à¸¡ (Position-Based) | à¹ƒà¸«à¸¡à¹ˆ (Shape-Based) |
|-----------------------|-------------------|
| âŒ à¸•à¹‰à¸­à¸‡à¸¢à¸·à¸™à¸•à¸£à¸‡à¸à¸±à¸š Ghost | âœ… à¸¢à¸·à¸™à¸•à¸£à¸‡à¹„à¸«à¸™à¸à¹‡à¹„à¸”à¹‰ |
| âŒ à¸•à¹‰à¸­à¸‡à¸—à¸³à¸§à¸‡à¹€à¸—à¹ˆà¸² Ghost | âœ… à¸§à¸‡à¹€à¸¥à¹‡à¸/à¹ƒà¸«à¸à¹ˆà¸à¹‡à¹„à¸”à¹‰ |
| âŒ à¸•à¹‰à¸­à¸‡à¹€à¸£à¹‡à¸§à¹€à¸—à¹ˆà¸² Ghost | âœ… à¸Šà¹‰à¸²/à¹€à¸£à¹‡à¸§à¸à¹‡à¹„à¸”à¹‰ |

---

## à¸‡.4 Rule 2: Arm Rotation

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ **à¸«à¸¡à¸¸à¸™à¸à¹ˆà¸²à¸¡à¸·à¸­ (à¸«à¸‡à¸²à¸¢/à¸„à¸§à¹ˆà¸³)** à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡à¸•à¸²à¸¡à¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 2: Arm Rotation Flowchart](../../out/docs/diagrams/HeuristicsRule2_ArmRotation/HeuristicsRule2_ArmRotation.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkArmRotation(thumb, pinky, moveType)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™                               â”‚
â”‚ - à¸¡à¸µ thumb, pinky landmarks à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ?                        â”‚
â”‚ - à¸¡à¸µ wristHistory à¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 2 frames?                        â”‚
â”‚ â†’ à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸„à¸£à¸š: return null                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸«à¸²à¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸·à¸­ (à¸‚à¸¶à¹‰à¸™/à¸¥à¸‡)             â”‚
â”‚                                                             â”‚
â”‚   deltaY = à¸‚à¹‰à¸­à¸¡à¸·à¸­à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™.y - à¸‚à¹‰à¸­à¸¡à¸·à¸­à¸à¹ˆà¸­à¸™à¸«à¸™à¹‰à¸².y                  â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² |deltaY| < 0.015 â†’ à¹„à¸¡à¹ˆà¸•à¸£à¸§à¸ˆ (ARM_MOTION_THRESHOLD)        â”‚
â”‚   à¸–à¹‰à¸² deltaY < 0 â†’ à¸à¸³à¸¥à¸±à¸‡à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸‚à¸¶à¹‰à¸™ (Moving Up)             â”‚
â”‚   à¸–à¹‰à¸² deltaY > 0 â†’ à¸à¸³à¸¥à¸±à¸‡à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸¥à¸‡ (Moving Down)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸°à¸à¹ˆà¸²à¸¡à¸·à¸­à¸ˆà¸£à¸´à¸‡ (Actual State)               â”‚
â”‚                                                             â”‚
â”‚   à¸¡à¸·à¸­à¸‚à¸§à¸² (rh_*):                                            â”‚
â”‚     thumb.x > pinky.x â†’ à¸«à¸‡à¸²à¸¢ (Supinated) âœ‹                  â”‚
â”‚     thumb.x < pinky.x â†’ à¸„à¸§à¹ˆà¸³ (Pronated) ğŸ¤š                  â”‚
â”‚                                                             â”‚
â”‚   à¸¡à¸·à¸­à¸‹à¹‰à¸²à¸¢ (lh_*):                                            â”‚
â”‚     thumb.x < pinky.x â†’ à¸«à¸‡à¸²à¸¢ (Supinated) âœ‹                  â”‚
â”‚     thumb.x > pinky.x â†’ à¸„à¸§à¹ˆà¸³ (Pronated) ğŸ¤š                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 4: à¸à¸³à¸«à¸™à¸”à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¸„à¸§à¸£à¸ˆà¸°à¹€à¸›à¹‡à¸™ (Expected State)             â”‚
â”‚                                                             â”‚
â”‚   à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸‚à¸¶à¹‰à¸™ (Moving Up):                             â”‚
â”‚     rh_cw, lh_ccw â†’ à¸„à¸§à¸£à¸«à¸‡à¸²à¸¢ (Supinated)                     â”‚
â”‚     rh_ccw, lh_cw â†’ à¸„à¸§à¸£à¸„à¸§à¹ˆà¸³ (Pronated)                      â”‚
â”‚                                                             â”‚
â”‚   à¹€à¸¡à¸·à¹ˆà¸­à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸¥à¸‡ (Moving Down):                            â”‚
â”‚     rh_ccw, lh_cw â†’ à¸„à¸§à¸£à¸«à¸‡à¸²à¸¢ (Supinated)                     â”‚
â”‚     rh_cw, lh_ccw â†’ à¸„à¸§à¸£à¸„à¸§à¹ˆà¸³ (Pronated)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 5: à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¹à¸¥à¸°à¸ªà¹ˆà¸‡ Feedback                          â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² Expected â‰  Actual                                     â”‚
â”‚     â†’ "âš ï¸ à¸«à¸¡à¸¸à¸™à¹à¸‚à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"                                  â”‚
â”‚   à¸–à¹‰à¸² Expected = Actual                                     â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸™à¸´à¹‰à¸§à¹‚à¸›à¹‰à¸‡ vs à¸™à¸´à¹‰à¸§à¸à¹‰à¸­à¸¢

```
   à¸¡à¸·à¸­à¸‚à¸§à¸² (Right Hand):
   
   à¸«à¸‡à¸²à¸¢ (Supinated)           à¸„à¸§à¹ˆà¸³ (Pronated)
   thumb.x > pinky.x          thumb.x < pinky.x
   
       ğŸ‘â”€â”€â”€â”€â”€â”€â”€ğŸ¤™                ğŸ¤™â”€â”€â”€â”€â”€â”€â”€ğŸ‘
       â†‘        â†‘                 â†‘        â†‘
     Thumb   Pinky              Pinky   Thumb
     (à¸‚à¸§à¸²)   (à¸‹à¹‰à¸²à¸¢)              (à¸‚à¸§à¸²)   (à¸‹à¹‰à¸²à¸¢)
   
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   
   à¸¡à¸·à¸­à¸‹à¹‰à¸²à¸¢ (Left Hand): à¸•à¸£à¸‡à¸‚à¹‰à¸²à¸¡à¸à¸±à¸™
   
   à¸«à¸‡à¸²à¸¢ = thumb.x < pinky.x
   à¸„à¸§à¹ˆà¸³ = thumb.x > pinky.x
```

### à¸•à¸²à¸£à¸²à¸‡ Logic

| à¸—à¹ˆà¸² | à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸‚à¸¶à¹‰à¸™ | à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸¥à¸‡ |
|-----|:----------:|:---------:|
| rh_cw / lh_ccw | à¸«à¸‡à¸²à¸¢ âœ‹ | à¸„à¸§à¹ˆà¸³ ğŸ¤š |
| rh_ccw / lh_cw | à¸„à¸§à¹ˆà¸³ ğŸ¤š | à¸«à¸‡à¸²à¸¢ âœ‹ |

### à¹‚à¸„à¹‰à¸”

```javascript
checkArmRotation(thumb, pinky, moveType) {
  // 1. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™
  if (!thumb || !pinky || this.wristHistory.length < 2) return null;

  // 2. à¸«à¸²à¸—à¸´à¸¨à¸—à¸²à¸‡à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ (à¸‚à¸¶à¹‰à¸™/à¸¥à¸‡)
  const p_current = this.wristHistory[this.wristHistory.length - 1];
  const p_previous = this.wristHistory[this.wristHistory.length - 2];
  const deltaY = p_current.y - p_previous.y;
  
  if (Math.abs(deltaY) < 0.015) return null; // à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸™à¹‰à¸­à¸¢à¹€à¸à¸´à¸™à¹„à¸› (ARM_MOTION_THRESHOLD)
  
  const isMovingUp = deltaY < 0;
  const isMovingDown = deltaY > 0;

  // 3. à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸°à¸à¹ˆà¸²à¸¡à¸·à¸­à¸ˆà¸£à¸´à¸‡
  const isRightHand = moveType.startsWith("rh");
  const isActuallySupinated = isRightHand
    ? thumb.x > pinky.x  // à¸¡à¸·à¸­à¸‚à¸§à¸²: à¸™à¸´à¹‰à¸§à¹‚à¸›à¹‰à¸‡à¸­à¸¢à¸¹à¹ˆà¸‚à¸§à¸² = à¸«à¸‡à¸²à¸¢
    : thumb.x < pinky.x; // à¸¡à¸·à¸­à¸‹à¹‰à¸²à¸¢: à¸™à¸´à¹‰à¸§à¹‚à¸›à¹‰à¸‡à¸­à¸¢à¸¹à¹ˆà¸‹à¹‰à¸²à¸¢ = à¸«à¸‡à¸²à¸¢

  // 4. à¸à¸³à¸«à¸™à¸”à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¸„à¸§à¸£à¸ˆà¸°à¹€à¸›à¹‡à¸™
  let isSupinationExpected = false;
  if (isMovingUp) {
    isSupinationExpected = moveType === "rh_cw" || moveType === "lh_ccw";
  } else if (isMovingDown) {
    isSupinationExpected = moveType === "rh_ccw" || moveType === "lh_cw";
  }

  // 5. à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸š
  return isSupinationExpected !== isActuallySupinated
    ? "âš ï¸ à¸«à¸¡à¸¸à¸™à¹à¸‚à¸™à¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡"
    : null;
}
```

---

## à¸‡.5 Rule 3: Elbow Sinking

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¸¨à¸­à¸à¸­à¸¢à¸¹à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²à¹„à¸«à¸¥à¹ˆ** à¹€à¸ªà¸¡à¸­ à¸•à¸²à¸¡à¸«à¸¥à¸±à¸ "à¸ˆà¸¡à¸¨à¸­à¸" (æ²‰è‚©å è‚˜)

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 3: Elbow Sinking Flowchart](../../out/docs/diagrams/HeuristicsRule3_ElbowSinking/HeuristicsRule3_ElbowSinking.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkElbowSinking(shoulder, elbow, wrist)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¸„à¸³à¸™à¸§à¸“ Tolerance                                    â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸²à¸¡à¸µ calibrationData:                                    â”‚
â”‚     tolerance = torsoHeight Ã— 0.05 (5%)                    â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ:                                                  â”‚
â”‚     tolerance = 0.01 (default)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ Y                                â”‚
â”‚                                                             â”‚
â”‚   à¹ƒà¸™à¸à¸´à¸à¸±à¸”à¸ à¸²à¸: Y à¹€à¸à¸´à¹ˆà¸¡à¸¥à¸‡à¸¥à¹ˆà¸²à¸‡                                   â”‚
â”‚   à¸¨à¸­à¸à¸„à¸§à¸£à¸­à¸¢à¸¹à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²à¹„à¸«à¸¥à¹ˆ = elbow.y > shoulder.y               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸ªà¹ˆà¸‡ Feedback                                       â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² elbow.y < shoulder.y - tolerance                      â”‚
â”‚     â†’ "âš ï¸ à¸¨à¸­à¸à¸¥à¸­à¸¢ (Elbow Floating)"                          â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚                                          â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸

```
   à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ âœ…                    à¸œà¸´à¸” âŒ
   
       â—  Shoulder                  â—  Shoulder
       â”‚                            â”‚
       â”‚ elbow.y > shoulder.y       â”‚ elbow.y < shoulder.y
       â”‚ (à¸¨à¸­à¸à¸­à¸¢à¸¹à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²)             â”‚ (à¸¨à¸­à¸à¸¥à¸­à¸¢à¸‚à¸¶à¹‰à¸™!)
       â–¼                            â–²
       â—  Elbow                     â—  Elbow
       â”‚                            â”‚
       â”‚                            â”‚
       â–¼                            â–¼
       â—  Wrist                     â—  Wrist
       
   * à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¹ƒà¸™à¸à¸´à¸à¸±à¸”à¸ à¸²à¸ Y à¹€à¸à¸´à¹ˆà¸¡à¸¥à¸‡à¸¥à¹ˆà¸²à¸‡
   * à¸”à¸±à¸‡à¸™à¸±à¹‰à¸™ elbow.y > shoulder.y = à¸¨à¸­à¸à¸­à¸¢à¸¹à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)
```

### à¹‚à¸„à¹‰à¸”

```javascript
checkElbowSinking(shoulder, elbow, wrist) {
  // Tolerance 5% à¸‚à¸­à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¸¥à¸³à¸•à¸±à¸§
  const tolerance = this.calibrationData
    ? this.calibrationData.torsoHeight * 0.05
    : 0.01;

  // à¸¨à¸­à¸à¸•à¹‰à¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¸•à¹ˆà¸³à¸à¸§à¹ˆà¸²à¹„à¸«à¸¥à¹ˆ (elbow.y > shoulder.y à¹ƒà¸™à¸à¸´à¸à¸±à¸”à¸ à¸²à¸)
  if (elbow.y < shoulder.y - tolerance) {
    return "âš ï¸ à¸¨à¸­à¸à¸¥à¸­à¸¢ (Elbow Floating)";
  }
  return null;
}
```

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¸ˆà¸¡à¹„à¸«à¸¥à¹ˆà¸•à¸à¸¨à¸­à¸"** (æ²‰è‚©å è‚˜) - à¹„à¸«à¸¥à¹ˆà¹à¸¥à¸°à¸¨à¸­à¸à¸•à¹‰à¸­à¸‡à¸œà¹ˆà¸­à¸™à¸¥à¸‡
> à¸Šà¹ˆà¸§à¸¢à¹ƒà¸«à¹‰à¸à¸¥à¸±à¸‡à¹„à¸«à¸¥à¸¥à¸‡à¸”à¸´à¸™ à¹„à¸¡à¹ˆà¸•à¸´à¸”à¸„à¹‰à¸²à¸‡à¸—à¸µà¹ˆà¹„à¸«à¸¥à¹ˆ

---

## à¸‡.6 Rule 4: Waist Initiation

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¹€à¸£à¸´à¹ˆà¸¡à¸ˆà¸²à¸à¹€à¸­à¸§** à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆà¸ˆà¸²à¸à¹„à¸«à¸¥à¹ˆ

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 4: Waist Initiation Flowchart](../../out/docs/diagrams/HeuristicsRule4_WaistInitiation/HeuristicsRule4_WaistInitiation.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkWaistInitiation(lHip, rHip, lShoulder, rShoulder, dt) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¸„à¸³à¸™à¸§à¸“à¸¡à¸¸à¸¡à¸‚à¸­à¸‡à¹€à¸­à¸§à¹à¸¥à¸°à¹„à¸«à¸¥à¹ˆ                               â”‚
â”‚                                                             â”‚
â”‚   hipAngle = atan2(rHip.y - lHip.y, rHip.x - lHip.x)       â”‚
â”‚   shoulderAngle = atan2(rShoulder.y - lShoulder.y, ...)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹€à¸Šà¸´à¸‡à¸¡à¸¸à¸¡ (degrees/sec)                  â”‚
â”‚                                                             â”‚
â”‚   hipVel = |hipAngle - lastHipAngle| / deltaTime           â”‚
â”‚   shoulderVel = |shoulderAngle - lastShoulderAngle| / dt   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¹„à¸«à¸¥à¹ˆà¸«à¸¡à¸¸à¸™à¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²à¹€à¸­à¸§                        â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² hipVel > 2.0 (à¹€à¸­à¸§à¸à¸³à¸¥à¸±à¸‡à¸«à¸¡à¸¸à¸™) AND                        â”‚
â”‚      shoulderVel > hipVel Ã— 3.0 (à¹„à¸«à¸¥à¹ˆà¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸² 3 à¹€à¸—à¹ˆà¸²)         â”‚
â”‚     â†’ "âš ï¸ à¹ƒà¸Šà¹‰à¹€à¸­à¸§à¸™à¸³ (Start with Waist)"                       â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚                                          â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸

```
   à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ âœ… (à¹€à¸­à¸§à¸™à¸³)            à¸œà¸´à¸” âŒ (à¹„à¸«à¸¥à¹ˆà¸™à¸³)
   
       â”Œâ”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”
       â”‚ à¹„à¸«à¸¥à¹ˆ â”‚ â† à¸«à¸¡à¸¸à¸™à¸Šà¹‰à¸²            â”‚ à¹„à¸«à¸¥à¹ˆ â”‚ â† à¸«à¸¡à¸¸à¸™à¹€à¸£à¹‡à¸§! 
       â””â”€â”€â”¬â”€â”€â”˜                     â””â”€â”€â”¬â”€â”€â”˜
          â”‚                           â”‚
       â”Œâ”€â”€â”´â”€â”€â”                     â”Œâ”€â”€â”´â”€â”€â”
       â”‚ à¹€à¸­à¸§ â”‚ â† à¸«à¸¡à¸¸à¸™à¸à¹ˆà¸­à¸™/à¹€à¸£à¹‡à¸§       â”‚ à¹€à¸­à¸§ â”‚ â† à¸«à¸¡à¸¸à¸™à¸Šà¹‰à¸²/à¹„à¸¡à¹ˆà¸«à¸¡à¸¸à¸™
       â””â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”˜
   
   hipVelocity > 2Â°/s             shoulderVelocity > hipVelocity Ã— 3
   shoulderVelocity â‰¤ hipVelocity Ã— 3
```

### à¹‚à¸„à¹‰à¸”

```javascript
checkWaistInitiation(leftHip, rightHip, leftShoulder, rightShoulder, deltaTime) {
  // à¸„à¸³à¸™à¸§à¸“à¸¡à¸¸à¸¡à¸‚à¸­à¸‡à¹€à¸­à¸§à¹à¸¥à¸°à¹„à¸«à¸¥à¹ˆ
  const hipAngle = Math.atan2(rightHip.y - leftHip.y, rightHip.x - leftHip.x);
  const shoulderAngle = Math.atan2(
    rightShoulder.y - leftShoulder.y,
    rightShoulder.x - leftShoulder.x
  );

  // à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¹€à¸Šà¸´à¸‡à¸¡à¸¸à¸¡ (degrees/second)
  const hipVel = this.getAngularVelocity(this.lastHipAngle, hipAngle, deltaTime);
  const shoulderVel = this.getAngularVelocity(this.lastShoulderAngle, shoulderAngle, deltaTime);

  // à¸­à¸±à¸›à¹€à¸”à¸•à¸„à¹ˆà¸²
  this.lastHipAngle = hipAngle;
  this.lastShoulderAngle = shoulderAngle;

  // à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸š: à¸–à¹‰à¸²à¹„à¸«à¸¥à¹ˆà¸«à¸¡à¸¸à¸™à¹€à¸£à¹‡à¸§à¸à¸§à¹ˆà¸²à¹€à¸­à¸§ 3 à¹€à¸—à¹ˆà¸² = à¹„à¸«à¸¥à¹ˆà¸™à¸³ (à¸œà¸´à¸”)
  const MIN_HIP_VELOCITY = 2.0;    // degrees/second
  const RATIO_THRESHOLD = 3.0;

  if (hipVel > MIN_HIP_VELOCITY && shoulderVel > hipVel * RATIO_THRESHOLD) {
    return "âš ï¸ à¹ƒà¸Šà¹‰à¹€à¸­à¸§à¸™à¸³ (Start with Waist)";
  }
  return null;
}
```

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¹€à¸­à¸§à¹€à¸›à¹‡à¸™à¸ˆà¸±à¸à¸£à¹€à¸à¸¥à¸²"** (è…°ä¸ºè½´) - à¸—à¸¸à¸à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸•à¹‰à¸­à¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸ˆà¸²à¸à¹€à¸­à¸§
> à¹€à¸­à¸§à¸«à¸¡à¸¸à¸™à¸™à¸³ à¹„à¸«à¸¥à¹ˆà¸•à¸²à¸¡ à¹à¸‚à¸™à¸•à¸²à¸¡ à¸¡à¸·à¸­à¸•à¸²à¸¡ à¹€à¸›à¹‡à¸™à¸¥à¸³à¸”à¸±à¸š

---

## à¸‡.7 Rule 5: Vertical Stability

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¸¨à¸µà¸£à¸©à¸°à¹„à¸¡à¹ˆà¸‚à¸¢à¸±à¸šà¸‚à¸¶à¹‰à¸™à¸¥à¸‡** à¸¡à¸²à¸à¹€à¸à¸´à¸™à¹„à¸› à¸•à¸²à¸¡à¸«à¸¥à¸±à¸ "à¹‚à¸›à¸£à¸‡à¸à¸£à¸°à¸«à¸¡à¹ˆà¸­à¸¡à¹€à¸šà¸²"

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 5: Vertical Stability Flowchart](../../out/docs/diagrams/HeuristicsRule5_VerticalStability/HeuristicsRule5_VerticalStability.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkVerticalStability(nose)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ Y à¸‚à¸­à¸‡à¸ˆà¸¡à¸¹à¸                         â”‚
â”‚                                                             â”‚
â”‚   headYHistory.push(nose.y)                                 â”‚
â”‚   à¹€à¸à¹‡à¸šà¹„à¸§à¹‰ 30 frames (~1 à¸§à¸´à¸™à¸²à¸—à¸µ à¸—à¸µà¹ˆ 30fps)                     â”‚
â”‚   à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸„à¸£à¸š 30 frames â†’ return null                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸«à¸²à¸„à¹ˆà¸² min/max à¹à¸¥à¸° displacement                    â”‚
â”‚                                                             â”‚
â”‚   min = Math.min(...headYHistory)                           â”‚
â”‚   max = Math.max(...headYHistory)                           â”‚
â”‚   displacement = max - min                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸„à¸³à¸™à¸§à¸“ Dynamic Threshold                            â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸²à¸¡à¸µ calibrationData:                                    â”‚
â”‚     threshold = torsoHeight Ã— 0.1 (10%)                    â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ:                                                  â”‚
â”‚     threshold = 0.05 (default)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 4: à¸ªà¹ˆà¸‡ Feedback                                       â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² displacement > threshold                              â”‚
â”‚     â†’ "âš ï¸ à¸¨à¸µà¸£à¸©à¸°à¹„à¸¡à¹ˆà¸™à¸´à¹ˆà¸‡ (Head Unstable)"                      â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚                                          â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸

```
   à¹€à¸à¹‡à¸šà¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ nose.y à¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡ 30 frames (~1 à¸§à¸´à¸™à¸²à¸—à¸µ)
   
   nose.y
     â”‚
   max â”¼â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€
     â”‚     â•±â†– displacement     â•²
     â”‚â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€
     â”‚             â†“
   min â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ time
          â† 30 frames (~1 sec) â†’
          
   à¸–à¹‰à¸² displacement > threshold â†’ "à¸¨à¸µà¸£à¸©à¸°à¹„à¸¡à¹ˆà¸™à¸´à¹ˆà¸‡"
```

### à¹‚à¸„à¹‰à¸”

```javascript
checkVerticalStability(nose) {
  if (!nose) return null;
  
  // à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´ nose.y
  this.headYHistory.push(nose.y);
  if (this.headYHistory.length > 30) this.headYHistory.shift();
  if (this.headYHistory.length < 30) return null;

  // à¸«à¸²à¸„à¹ˆà¸² min/max
  const min = Math.min(...this.headYHistory);
  const max = Math.max(...this.headYHistory);
  const displacement = max - min;

  // Dynamic Threshold: 10% à¸‚à¸­à¸‡à¸„à¸§à¸²à¸¡à¸ªà¸¹à¸‡à¸¥à¸³à¸•à¸±à¸§
  let threshold = 0.05;
  if (this.calibrationData) {
    threshold = this.calibrationData.torsoHeight * 0.1;
  }

  return displacement > threshold
    ? "âš ï¸ à¸¨à¸µà¸£à¸©à¸°à¹„à¸¡à¹ˆà¸™à¸´à¹ˆà¸‡ (Head Unstable)"
    : null;
}
```

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¹‚à¸›à¸£à¸‡à¸à¸£à¸°à¸«à¸¡à¹ˆà¸­à¸¡à¹€à¸šà¸²"** (è™šé¢†é¡¶åŠ²) - à¸¨à¸µà¸£à¸©à¸°à¸•à¹‰à¸­à¸‡à¸¥à¸­à¸¢à¹€à¸šà¸²à¹† à¹€à¸«à¸¡à¸·à¸­à¸™à¸¥à¸­à¸¢à¸™à¹‰à¸³
> à¹„à¸¡à¹ˆà¹‚à¸¢à¸à¸‚à¸¶à¹‰à¸™à¸¥à¸‡à¸‚à¸“à¸°à¸–à¹ˆà¸²à¸¢à¸™à¹‰à¸³à¸«à¸™à¸±à¸

---

## à¸‡.8 Rule 6: Smoothness

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸¥à¸·à¹ˆà¸™à¹„à¸«à¸¥** à¹„à¸¡à¹ˆà¸ªà¸°à¸”à¸¸à¸” à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸ªà¸¡à¹ˆà¸³à¹€à¸ªà¸¡à¸­

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 6: Smoothness Flowchart](../../out/docs/diagrams/HeuristicsRule6_Smoothness/HeuristicsRule6_Smoothness.svg)

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkSmoothness(wrist, timestamp)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸à¸£à¹‰à¸­à¸¡ timestamp                          â”‚
â”‚                                                             â”‚
â”‚   wristHistory.push({ x, y, t: timestamp })                 â”‚
â”‚   à¹€à¸à¹‡à¸šà¹„à¸§à¹‰ 10 frames                                         â”‚
â”‚   à¸–à¹‰à¸²à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸„à¸£à¸š 3 frames â†’ return null                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸„à¸³à¸™à¸§à¸“ Time-Normalized Velocity                     â”‚
â”‚                                                             â”‚
â”‚   dt1 = (p2.t - p1.t) / 1000   (seconds)                   â”‚
â”‚   dt2 = (p3.t - p2.t) / 1000                               â”‚
â”‚                                                             â”‚
â”‚   v1 = distance(p1, p2) / dt1  (units/sec)                 â”‚
â”‚   v2 = distance(p2, p3) / dt2                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸„à¸³à¸™à¸§à¸“ Acceleration                                 â”‚
â”‚                                                             â”‚
â”‚   acceleration = |v2 - v1|                                  â”‚
â”‚   (à¸„à¹ˆà¸²à¸ªà¸¹à¸‡ = à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸à¸°à¸—à¸±à¸™à¸«à¸±à¸™ = à¸ªà¸°à¸”à¸¸à¸”)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 4: à¹€à¸›à¸£à¸µà¸¢à¸šà¹€à¸—à¸µà¸¢à¸šà¸à¸±à¸š Dynamic Threshold                    â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸²à¸¡à¸µ calibrationData:                                    â”‚
â”‚     threshold = armLength Ã— 0.05 (5%)                      â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µ:                                                  â”‚
â”‚     threshold = 0.02 (default)                              â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² acceleration > threshold                              â”‚
â”‚     â†’ "âš ï¸ à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸ªà¸°à¸”à¸¸à¸” (Not Smooth)"                   â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚                                          â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸

```
   à¸„à¸³à¸™à¸§à¸“ Time-Normalized Velocity à¹à¸¥à¸° Acceleration
   
   Position
     â”‚     p3 (à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™)
     â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—
     â”‚                    â”‚
     â”‚    p2              â”‚
     â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                    â”‚
     â”‚ p1                 â”‚
     â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ time
        dt1        dt2
        
   v1 = distance(p1, p2) / dt1   (units/sec)
   v2 = distance(p2, p3) / dt2   (units/sec)
   acceleration = |v2 - v1|
   
   à¸–à¹‰à¸² acceleration > threshold â†’ "à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸ªà¸°à¸”à¸¸à¸”"
```

### à¹‚à¸„à¹‰à¸”

```javascript
checkSmoothness(wrist, timestamp) {
  if (!wrist) return null;
  
  // à¹€à¸à¹‡à¸š wrist à¸à¸£à¹‰à¸­à¸¡ timestamp
  const currentTime = timestamp || Date.now();
  this.wristHistory.push({ x: wrist.x, y: wrist.y, t: currentTime });
  if (this.wristHistory.length > 10) this.wristHistory.shift();
  if (this.wristHistory.length < 3) return null;

  const p3 = this.wristHistory[this.wristHistory.length - 1];
  const p2 = this.wristHistory[this.wristHistory.length - 2];
  const p1 = this.wristHistory[this.wristHistory.length - 3];

  // Time-normalized velocity
  const dt2 = (p3.t - p2.t) / 1000; // seconds
  const dt1 = (p2.t - p1.t) / 1000;
  if (dt1 <= 0 || dt2 <= 0) return null;

  const v2 = this.calculateDistance(p2, p3) / dt2;
  const v1 = this.calculateDistance(p1, p2) / dt1;
  const acceleration = Math.abs(v2 - v1);

  // Threshold: 8% à¸‚à¸­à¸‡à¸„à¸§à¸²à¸¡à¸¢à¸²à¸§à¹à¸‚à¸™ (SMOOTHNESS_CALIBRATION_RATIO)
  let threshold = 0.05;  // SMOOTHNESS_THRESHOLD_DEFAULT (à¹€à¸”à¸´à¸¡ 0.02)
  if (this.calibrationData) {
    threshold = this.calibrationData.armLength * 0.08;  // (à¹€à¸”à¸´à¸¡ 0.05)
  }

  return acceleration > threshold
    ? "âš ï¸ à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸ªà¸°à¸”à¸¸à¸” (Not Smooth)"
    : null;
}
```
---

## à¸‡.9 Rule 7: Continuity (Time-Based v0.9.9)

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¹„à¸¡à¹ˆà¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡** à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸à¸²à¸£à¸à¸¶à¸

### Implementation Notes (v0.9.9)

> **à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ˆà¸²à¸ Frame-Based à¹€à¸›à¹‡à¸™ Time-Based**
> 
> à¹€à¸”à¸´à¸¡: à¸™à¸±à¸š frames à¸—à¸µà¹ˆ velocity à¸•à¹ˆà¸³ (pauseCounter > 15)
> 
> à¹ƒà¸«à¸¡à¹ˆ: à¸„à¸³à¸™à¸§à¸“ Average Velocity à¹ƒà¸™ time window (2 à¸§à¸´à¸™à¸²à¸—à¸µ)
> 
> **à¹€à¸«à¸•à¸¸à¸œà¸¥:** Skip Frame Logic à¸—à¸³à¹ƒà¸«à¹‰ Heuristics à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸à¹à¸„à¹ˆ ~0.83 à¸„à¸£à¸±à¹‰à¸‡/à¸§à¸´à¸™à¸²à¸—à¸µ

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™ (Time-Based)

![Rule 7: Continuity Flowchart](../../out/docs/diagrams/HeuristicsRule7_Continuity/HeuristicsRule7_Continuity.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkContinuity() â†’ isPaused()                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Filter wristHistory à¹ƒà¸™ time window (2 à¸§à¸´à¸™à¸²à¸—à¸µà¸¥à¹ˆà¸²à¸ªà¸¸à¸”)       â”‚
â”‚    recentPoints = filter(p => p.t >= now - PAUSE_WINDOW_MS) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. à¸„à¸³à¸™à¸§à¸“ Total Distance à¹à¸¥à¸° Average Velocity                â”‚
â”‚    avgVelocity = totalDistance / timeSpan                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. à¸–à¹‰à¸² avgVelocity < PAUSE_AVG_VELOCITY_THRESHOLD           â”‚
â”‚    â†’ "âš ï¸ à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡ à¸­à¸¢à¹ˆà¸²à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡"                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸ Time Window

```
   wristHistory:  â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€â—â”€â”€
                             â”‚â† PAUSE_WINDOW_MS â†’â”‚now
                             â””â”€â”€ recentPoints â”€â”€â”€â”˜
   
   avgVelocity = totalDistance / timeSpan
   à¸–à¹‰à¸² avgVelocity < 0.003 â†’ "à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡"
```

### à¹‚à¸„à¹‰à¸”

```javascript
// isPaused() - Shared helper (Rule 1 + Rule 7)
isPaused() {
  if (this.wristHistory.length < 3) return false;
  
  const now = Date.now();
  const windowStart = now - this.CONFIG.PAUSE_WINDOW_MS;
  const recentPoints = this.wristHistory.filter(p => p.t >= windowStart);
  
  if (recentPoints.length < 2) return false;
  
  let totalDistance = 0;
  for (let i = 1; i < recentPoints.length; i++) {
    totalDistance += this.calculateDistance(recentPoints[i-1], recentPoints[i]);
  }
  
  const timeSpanMs = recentPoints[recentPoints.length-1].t - recentPoints[0].t;
  const avgVelocity = totalDistance / (timeSpanMs / 1000);
  
  return avgVelocity < this.CONFIG.PAUSE_AVG_VELOCITY_THRESHOLD;
}

// checkContinuity() - Rule 7
checkContinuity() {
  return this.isPaused() ? this.getMessage("keepMoving") : null;
}
```

### CONFIG

| Parameter | à¸„à¹ˆà¸² | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|-----------|-----|----------|
| `PAUSE_WINDOW_MS` | 2000 | à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œà¸¢à¹‰à¸­à¸™à¸«à¸¥à¸±à¸‡ 2 à¸§à¸´à¸™à¸²à¸—à¸µ |
| `PAUSE_AVG_VELOCITY_THRESHOLD` | 0.003 | avgVelocity à¸•à¹ˆà¸³à¸à¸§à¹ˆà¸² = à¸«à¸¢à¸¸à¸”à¸™à¸´à¹ˆà¸‡ |

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡à¹„à¸¡à¹ˆà¸‚à¸²à¸”à¸•à¸­à¸™"** (ç»µç»µä¸æ–­) - à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸•à¹‰à¸­à¸‡à¸•à¹ˆà¸­à¹€à¸™à¸·à¹ˆà¸­à¸‡à¹€à¸«à¸¡à¸·à¸­à¸™à¸”à¸¶à¸‡à¹€à¸ªà¹‰à¸™à¹„à¸«à¸¡

---

## à¸‡.10 Rule 8: Weight Shift

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² **à¸ˆà¸¸à¸”à¸¨à¸¹à¸™à¸¢à¹Œà¸–à¹ˆà¸§à¸‡à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸à¸²à¸™à¸à¸²à¸£à¸¢à¸·à¸™** à¹„à¸¡à¹ˆà¹€à¸­à¸µà¸¢à¸‡à¸ˆà¸™à¹€à¸ªà¸µà¸¢à¸ªà¸¡à¸”à¸¸à¸¥

### Algorithm à¸—à¸µà¸¥à¸°à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™

![Rule 8: Weight Shift Flowchart](../../out/docs/diagrams/HeuristicsRule8_WeightShift/HeuristicsRule8_WeightShift.svg)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkWeightShift(leftHip, rightHip, leftAnkle, rightAnkle) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¸„à¸³à¸™à¸§à¸“à¸ˆà¸¸à¸”à¸à¸¶à¹ˆà¸‡à¸à¸¥à¸²à¸‡à¸ªà¸°à¹‚à¸à¸ (Center of Mass)              â”‚
â”‚                                                             â”‚
â”‚   hipCenter = (leftHip.x + rightHip.x) / 2                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸à¸³à¸«à¸™à¸”à¸‚à¸­à¸šà¹€à¸‚à¸•à¸à¸²à¸™à¸à¸²à¸£à¸¢à¸·à¸™ (Base of Support)            â”‚
â”‚                                                             â”‚
â”‚   stanceWidth = |leftAnkle.x - rightAnkle.x|               â”‚
â”‚   leftBoundary = min(leftAnkle.x, rightAnkle.x)            â”‚
â”‚   rightBoundary = max(leftAnkle.x, rightAnkle.x)           â”‚
â”‚   buffer = stanceWidth Ã— 0.1 (10% à¸à¸±à¸™à¸Šà¸™)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸ªà¸°à¹‚à¸à¸à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™ Safe Zone                     â”‚
â”‚                                                             â”‚
â”‚   Safe Zone = [leftBoundary + buffer, rightBoundary - buffer]â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² hipCenter < leftBoundary + buffer (à¹€à¸­à¸µà¸¢à¸‡à¸‹à¹‰à¸²à¸¢)          â”‚
â”‚   OR hipCenter > rightBoundary - buffer (à¹€à¸­à¸µà¸¢à¸‡à¸‚à¸§à¸²)          â”‚
â”‚     â†’ "âš ï¸ à¹€à¸ªà¸µà¸¢à¸ªà¸¡à¸”à¸¸à¸¥ (Off Balance)"                           â”‚
â”‚   à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸‚à¹‰à¸²à¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚                                          â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸

```
   à¸¡à¸­à¸‡à¸ˆà¸²à¸à¸”à¹‰à¸²à¸™à¸šà¸™ (Top View)
   
   leftAnkle                     rightAnkle
       â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—
       â”‚â† buffer â†’â”‚ Safe Zone â”‚â† buffer â†’â”‚
       â”‚          â”‚           â”‚          â”‚
       â”‚    âŒ    â”‚     âœ…    â”‚    âŒ     â”‚
       â”‚  Off     â”‚  hipCenterâ”‚  Off     â”‚
       â”‚ Balance  â”‚    â—      â”‚ Balance  â”‚
       â”‚          â”‚           â”‚          â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       
   leftBoundary              rightBoundary
   + buffer                  - buffer
```

### à¹‚à¸„à¹‰à¸”

```javascript
checkWeightShift(leftHip, rightHip, leftAnkle, rightAnkle) {
  if (!leftHip || !rightHip || !leftAnkle || !rightAnkle) return null;

  // à¸„à¸³à¸™à¸§à¸“à¸ˆà¸¸à¸”à¸à¸¶à¹ˆà¸‡à¸à¸¥à¸²à¸‡à¸ªà¸°à¹‚à¸à¸
  const hipCenter = (leftHip.x + rightHip.x) / 2;
  const stanceWidth = Math.abs(leftAnkle.x - rightAnkle.x);

  // à¸à¸³à¸«à¸™à¸”à¸‚à¸­à¸šà¹€à¸‚à¸•à¸‚à¸­à¸‡à¸à¸²à¸™à¸à¸²à¸£à¸¢à¸·à¸™
  const leftBoundary = Math.min(leftAnkle.x, rightAnkle.x);
  const rightBoundary = Math.max(leftAnkle.x, rightAnkle.x);

  // à¹€à¸à¸´à¹ˆà¸¡à¸£à¸°à¸¢à¸°à¸à¸±à¸™à¸Šà¸™ 10% à¸‚à¸­à¸‡à¸„à¸§à¸²à¸¡à¸à¸§à¹‰à¸²à¸‡à¸à¸²à¸£à¸¢à¸·à¸™
  const buffer = stanceWidth * 0.1;

  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸ªà¸°à¹‚à¸à¸à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸‚à¸­à¸šà¹€à¸‚à¸•à¸«à¸£à¸·à¸­à¹„à¸¡à¹ˆ
  if (hipCenter < leftBoundary + buffer || 
      hipCenter > rightBoundary - buffer) {
    return "âš ï¸ à¹€à¸ªà¸µà¸¢à¸ªà¸¡à¸”à¸¸à¸¥ (Off Balance)";
  }
  return null;
}
```

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¹à¸¢à¸à¹€à¸•à¹‡à¸¡à¸§à¹ˆà¸²à¸‡"** (åˆ†è™šå®) - à¸£à¸¹à¹‰à¸ˆà¸±à¸à¸–à¹ˆà¸²à¸¢à¸™à¹‰à¸³à¸«à¸™à¸±à¸à¸‹à¹‰à¸²à¸¢/à¸‚à¸§à¸²
> à¹à¸•à¹ˆà¸•à¹‰à¸­à¸‡à¹„à¸¡à¹ˆà¹€à¸­à¸µà¸¢à¸‡à¸ˆà¸™à¹€à¸ªà¸µà¸¢à¸ªà¸¡à¸”à¸¸à¸¥ à¸ˆà¸¸à¸”à¸¨à¸¹à¸™à¸¢à¹Œà¸–à¹ˆà¸§à¸‡à¸•à¹‰à¸­à¸‡à¸­à¸¢à¸¹à¹ˆà¹€à¸«à¸™à¸·à¸­à¸à¸²à¸™

---

## à¸‡.11 Rule 9: Coordination (Upper-Lower)

### à¸§à¸±à¸•à¸–à¸¸à¸›à¸£à¸°à¸ªà¸‡à¸„à¹Œ

à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸‚à¸­à¸‡à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡ **à¸ªà¹ˆà¸§à¸™à¸šà¸™ (à¸¡à¸·à¸­)** à¹à¸¥à¸° **à¸ªà¹ˆà¸§à¸™à¸¥à¹ˆà¸²à¸‡ (à¸ªà¸°à¹‚à¸à¸/à¸‚à¸²)** à¸•à¸²à¸¡à¸«à¸¥à¸±à¸ "à¸šà¸™à¸¥à¹ˆà¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸™" (ä¸Šä¸‹ç›¸éš)

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¸šà¸™à¸¥à¹ˆà¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸™"** (ä¸Šä¸‹ç›¸éš) - à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸²à¸à¸‚à¸¢à¸±à¸š à¸¢à¸­à¸”à¸à¹‡à¸‚à¸¢à¸±à¸š
> à¸—à¸´à¸¨à¸—à¸²à¸‡à¸‚à¸­à¸‡à¹à¸£à¸‡à¸•à¹‰à¸­à¸‡à¸ªà¸­à¸”à¸„à¸¥à¹‰à¸­à¸‡à¸à¸±à¸™ à¹„à¸¡à¹ˆà¸‚à¸±à¸”à¹à¸¢à¹‰à¸‡à¸à¸±à¸™

![Rule 9: Coordination Flowchart](../../out/docs/diagrams/HeuristicsRule9_Coordination/HeuristicsRule9_Coordination.svg)

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  checkCoordination(wrist, hipCenter, dt)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 1: à¸„à¸³à¸™à¸§à¸“à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§ (Velocity)                           â”‚
â”‚                                                             â”‚
â”‚   handVelX = (wrist.x - lastWrist.x) / dt                   â”‚
â”‚   hipVelX = (hipCenter.x - lastHipCenter.x) / dt            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 2: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Deadzone                                   â”‚
â”‚                                                             â”‚
â”‚   threshold = 0.02                                          â”‚
â”‚   à¸–à¹‰à¸² |handVelX| < threshold à¹à¸¥à¸° |hipVelX| < threshold       â”‚
â”‚     â†’ return null (à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¸Šà¹‰à¸²à¹€à¸à¸´à¸™à¹„à¸› à¹„à¸¡à¹ˆà¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ)            â”‚
â”‚   âš ï¸ à¹ƒà¸Šà¹‰ AND (à¹„à¸¡à¹ˆà¹ƒà¸Šà¹ˆ OR) à¹€à¸à¸£à¸²à¸°à¹€à¸­à¸§à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¸Šà¹‰à¸²à¸à¸§à¹ˆà¸²à¸¡à¸·à¸­        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸‚à¸±à¹‰à¸™à¸—à¸µà¹ˆ 3: à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸—à¸´à¸¨à¸—à¸²à¸‡ (Direction Check)                    â”‚
â”‚                                                             â”‚
â”‚   signHand = Math.sign(handVelX)                            â”‚
â”‚   signHip = Math.sign(hipVelX)                              â”‚
â”‚                                                             â”‚
â”‚   à¸–à¹‰à¸² signHand * signHip < 0 (à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™)               â”‚
â”‚     â†’ "âš ï¸ à¸¡à¸·à¸­à¹à¸¥à¸°à¹€à¸—à¹‰à¸²à¹„à¸¡à¹ˆà¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸™ (Coordination Mismatch)"      â”‚
â”‚   à¸–à¹‰à¸²à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™                                       â”‚
â”‚     â†’ null (à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡)                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### à¹à¸œà¸™à¸ à¸²à¸

```text
   à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ âœ… (à¹„à¸›à¸—à¸²à¸‡à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™)      à¸œà¸´à¸” âŒ (à¸ªà¸§à¸™à¸—à¸²à¸‡à¸à¸±à¸™)

      â†’ à¸¡à¸·à¸­à¹„à¸›à¸‚à¸§à¸²                    â†’ à¸¡à¸·à¸­à¹„à¸›à¸‚à¸§à¸²

      â†’ à¸ªà¸°à¹‚à¸à¸à¹„à¸›à¸‚à¸§à¸²                  â† à¸ªà¸°à¹‚à¸à¸à¹„à¸›à¸‹à¹‰à¸²à¸¢
```

### à¹‚à¸„à¹‰à¸”

```javascript
checkCoordination(wrist, hipCenterProp) {
  // 0. Track Hip History (à¹€à¸à¹‡à¸šà¸›à¸£à¸°à¸§à¸±à¸•à¸´ Hip Center à¸à¸£à¹‰à¸­à¸¡ timestamp)
  if (!this.hipHistory) this.hipHistory = [];
  this.hipHistory.push({ x: hipCenterProp, t: Date.now() });
  if (this.hipHistory.length > 60) this.hipHistory.shift();
  
  if (this.hipHistory.length < 3) return null;

  // 1. à¸„à¸³à¸™à¸§à¸“ Velocity (à¹ƒà¸Šà¹‰ 3 à¸ˆà¸¸à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸”à¹€à¸à¸·à¹ˆà¸­à¸¥à¸” noise)
  const handP3 = this.wristHistory[this.wristHistory.length - 1];
  const handP1 = this.wristHistory[this.wristHistory.length - 3];
  const handDt = (handP3.t - handP1.t) / 1000;
  const handVelX = (handP3.x - handP1.x) / handDt;

  const hipP3 = this.hipHistory[this.hipHistory.length - 1];
  const hipP1 = this.hipHistory[this.hipHistory.length - 3];
  const hipDt = (hipP3.t - hipP1.t) / 1000;
  const hipVelX = (hipP3.x - hipP1.x) / hipDt;

  // 2. Deadzone Check (Threshold = 0.02, à¹ƒà¸Šà¹‰ AND)
  const threshold = this.CONFIG.COORDINATION_VELOCITY_THRESHOLD || 0.02;
  if (Math.abs(handVelX) < threshold && Math.abs(hipVelX) < threshold) {
    return null;  // à¸—à¸±à¹‰à¸‡à¸ªà¸­à¸‡à¸Šà¹‰à¸²à¹€à¸à¸´à¸™à¹„à¸›
  }

  // 3. Direction Check (Sign mismatch = Error)
  if (Math.sign(handVelX) * Math.sign(hipVelX) < 0) {
    return "âš ï¸ à¸¡à¸·à¸­à¹à¸¥à¸°à¹€à¸—à¹‰à¸²à¹„à¸¡à¹ˆà¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸™";
  }

  return null;
}
```

### à¸«à¸¥à¸±à¸à¸à¸²à¸£

> **"à¸šà¸™à¸¥à¹ˆà¸²à¸‡à¸ªà¸±à¸¡à¸à¸±à¸™à¸˜à¹Œà¸à¸±à¸™"** (ä¸Šä¸‹ç›¸éš) - à¹€à¸¡à¸·à¹ˆà¸­à¸£à¸²à¸à¸‚à¸¢à¸±à¸š à¸¢à¸­à¸”à¸à¹‡à¸‚à¸¢à¸±à¸š
> à¸—à¸´à¸¨à¸—à¸²à¸‡à¸‚à¸­à¸‡à¹à¸£à¸‡à¸•à¹‰à¸­à¸‡à¸ªà¸­à¸”à¸„à¸¥à¹‰à¸­à¸‡à¸à¸±à¸™ à¹„à¸¡à¹ˆà¸‚à¸±à¸”à¹à¸¢à¹‰à¸‡à¸à¸±à¸™

---

## à¸‡.12 Priority Ranking

à¹€à¸¡à¸·à¹ˆà¸­à¸•à¸£à¸§à¸ˆà¸à¸šà¸«à¸¥à¸²à¸¢à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸” à¸ˆà¸°à¹à¸ªà¸”à¸‡ **à¹€à¸‰à¸à¸²à¸°à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¸ªà¸³à¸„à¸±à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”**:

```
   Priority 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Priority 9
   
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Path   â”‚  â”‚  Waist  â”‚  â”‚ Weight  â”‚  â”‚ Coord.  â”‚
   â”‚Accuracy â”‚â†’ â”‚Initiationâ”‚â†’ â”‚  Shift  â”‚â†’ â”‚ (Rule 9)â”‚
   â”‚    1    â”‚  â”‚    2    â”‚  â”‚    3    â”‚  â”‚    4    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚            â”‚            â”‚
        â–¼            â–¼            â–¼            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Verticalâ”‚  â”‚   Arm   â”‚  â”‚  Elbow  â”‚  â”‚Smoothnessâ”‚
   â”‚Stabilityâ”‚  â”‚Rotation â”‚  â”‚ Sinking â”‚  â”‚    8    â”‚
   â”‚    5    â”‚  â”‚    6    â”‚  â”‚    7    â”‚  â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚Continuityâ”‚
   â”‚    9    â”‚
   â”‚         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## à¸‡.13 Level Configuration

à¹à¸•à¹ˆà¸¥à¸°à¸£à¸°à¸”à¸±à¸šà¸¡à¸µà¸ˆà¸³à¸™à¸§à¸™à¸à¸à¸—à¸µà¹ˆà¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹à¸•à¸à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™ à¹€à¸à¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¸„à¸§à¸²à¸¡à¸ªà¸²à¸¡à¸²à¸£à¸–à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¸à¸¶à¸:

### à¸ªà¸£à¸¸à¸›à¸£à¸°à¸”à¸±à¸šà¸„à¸§à¸²à¸¡à¸¢à¸²à¸

| à¸£à¸°à¸”à¸±à¸š | à¸ˆà¸³à¸™à¸§à¸™à¸à¸ | à¸à¸¥à¸¸à¹ˆà¸¡à¹€à¸›à¹‰à¸²à¸«à¸¡à¸²à¸¢ | à¸—à¹ˆà¸² |
|-------|:-------:|--------------|-----|
| **L1** | **3 à¸à¸** | à¸œà¸¹à¹‰à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™/à¸ªà¸¹à¸‡à¸­à¸²à¸¢à¸¸ | à¸™à¸±à¹ˆà¸‡ |
| **L2** | **6 à¸à¸** | à¸£à¸°à¸”à¸±à¸šà¸à¸¥à¸²à¸‡ | à¸¢à¸·à¸™ |
| **L3** | **9 à¸à¸** | à¸£à¸°à¸”à¸±à¸šà¸ªà¸¹à¸‡ | à¸¢à¸·à¸™à¸¢à¹ˆà¸­ |

### à¸•à¸²à¸£à¸²à¸‡à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”

| Rule | à¸Šà¸·à¹ˆà¸­ | L1 (à¸™à¸±à¹ˆà¸‡) | L2 (à¸¢à¸·à¸™) | L3 (à¸¢à¹ˆà¸­) |
|:----:|------|:---------:|:---------:|:---------:|
| 1 | Path Accuracy | âœ… | âœ… | âœ… |
| 2 | Arm Rotation | âŒ | âœ… | âœ… |
| 3 | Elbow Sinking | âœ… | âœ… | âœ… |
| 4 | Waist Initiation | âŒ | âœ… | âœ… |
| 5 | Vertical Stability | âŒ | âŒ | âœ… |
| 6 | Smoothness | âŒ | âœ… | âœ… |
| 7 | Continuity | âœ… | âœ… | âœ… |
| 8 | Weight Shift | âŒ | âŒ | âœ… |
| 9 | Coordination | âŒ | âŒ | âœ… |

**à¸ªà¸£à¸¸à¸›:**
- L1 (3 à¸à¸): Path, Elbow, Continuity
- L2 (6 à¸à¸): + Rotation, Waist, Smoothness
- L3 (9 à¸à¸): + Stability, Weight, Coordination (à¸„à¸£à¸šà¸—à¸¸à¸à¸à¸)

---

## à¸‡.14 à¸•à¸²à¸£à¸²à¸‡ CONFIG Parameters à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”

| à¸à¸ | Parameter | à¸„à¹ˆà¸² Default | à¸„à¸³à¸­à¸˜à¸´à¸šà¸²à¸¢ |
|:--:|-----------|:-----------:|----------|
| 1 | `SHAPE_CONSISTENCY_THRESHOLD` | 0.6 | 60% à¸‚à¸¶à¹‰à¸™à¹„à¸› = à¹€à¸›à¹‡à¸™à¸§à¸‡ |
| 1 | `SHAPE_ANALYSIS_POINTS` | 10 | à¹ƒà¸Šà¹‰ 10 à¸ˆà¸¸à¸”à¸¥à¹ˆà¸²à¸ªà¸¸à¸” (slice-based) |
| 2 | `ARM_MOTION_THRESHOLD` | 0.015 | à¸‚à¸µà¸”à¸ˆà¸³à¸à¸±à¸”à¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆ |
| 3 | `ELBOW_TOLERANCE_RATIO` | 0.05 | 5% à¸‚à¸­à¸‡à¸¥à¸³à¸•à¸±à¸§ |
| 4 | `MIN_HIP_VELOCITY_DEG_SEC` | 2.0 | Â°/à¸§à¸´à¸™à¸²à¸—à¸µ |
| 4 | `SHOULDER_HIP_RATIO` | 3.0 | à¹„à¸«à¸¥à¹ˆ > à¹€à¸­à¸§ Ã— 3 = à¸œà¸´à¸” |
| 5 | `STABILITY_THRESHOLD_RATIO` | 0.1 | 10% à¸‚à¸­à¸‡à¸¥à¸³à¸•à¸±à¸§ |
| 5 | `STABILITY_FRAMES` | 30 | à¸§à¸´à¹€à¸„à¸£à¸²à¸°à¸«à¹Œ ~1 à¸§à¸´à¸™à¸²à¸—à¸µ |
| 6 | `SMOOTHNESS_THRESHOLD_DEFAULT` | 0.05 | à¸„à¹ˆà¸² default (à¹€à¸”à¸´à¸¡ 0.02) |
| 6 | `SMOOTHNESS_CALIBRATION_RATIO` | 0.08 | 8% à¸‚à¸­à¸‡à¹à¸‚à¸™ (à¹€à¸”à¸´à¸¡ 0.05) |
| 7 | `PAUSE_WINDOW_MS` | 2000 | 2 à¸§à¸´à¸™à¸²à¸—à¸µ |
| 7 | `PAUSE_AVG_VELOCITY_THRESHOLD` | 0.003 | à¸«à¸™à¹ˆà¸§à¸¢ normalized |
| 8 | `WEIGHT_BUFFER_RATIO` | 0.1 | 10% à¸‚à¸­à¸‡à¸à¸²à¸™ |
| 9 | `COORDINATION_VELOCITY_THRESHOLD` | 0.02 | à¸„à¸§à¸²à¸¡à¹€à¸£à¹‡à¸§à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³ (AND logic) |

---

## à¸‡.15 Debug Mode

à¸à¸” **`D`** à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸à¸¶à¸à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸„à¹ˆà¸² real-time:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§ DEBUG MODE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Performance Metrics:                         â”‚
â”‚  - FPS: 30                (Camera)           â”‚
â”‚  - AI Rate: 8             (Processing)       â”‚
â”‚  - frameCount: 1234                          â”‚
â”‚  - score: 85.2%                              â”‚
â”‚                                              â”‚
â”‚ Rule 1: Path Accuracy                        â”‚
â”‚  - shapeConsistency: 0.75                    â”‚
â”‚  - shapeThreshold: 0.60                      â”‚
â”‚  - cwTurns: 3                                â”‚
â”‚  - ccwTurns: 2                               â”‚
â”‚  - shapePoints: 10                           â”‚
â”‚  - pathDistance: 0.045                       â”‚
â”‚  - pathThreshold: 0.080                      â”‚
â”‚                                              â”‚
â”‚ Rule 4: Waist Initiation                     â”‚
â”‚  - shoulderVel: 12.3                         â”‚
â”‚  - hipVel: 5.2                               â”‚
â”‚                                              â”‚
â”‚ Rule 5: Vertical Stability                   â”‚
â”‚  - headDisplacement: 0.0123                  â”‚
â”‚  - stabilityThreshold: 0.0500                â”‚
â”‚  - headHistoryPoints: 30                     â”‚
â”‚                                              â”‚
â”‚ Rule 6: Smoothness                           â”‚
â”‚  - wristVelocity: 0.123                      â”‚
â”‚  - acceleration: 0.015                       â”‚
â”‚  - smoothThreshold: 0.050                    â”‚
â”‚                                              â”‚
â”‚ Rule 7: Continuity                           â”‚
â”‚  - isPaused: false                           â”‚
â”‚                                              â”‚
â”‚ Rule 8: Weight Shift                         â”‚
â”‚  - hipCenter: 0.512                          â”‚
â”‚  - safeZone: 0.300 - 0.700                   â”‚
â”‚                                              â”‚
â”‚ Rule 9: Coordination                         â”‚
â”‚  - coordination: OK / Mismatch               â”‚
â”‚  - handVelX: 0.120                           â”‚
â”‚  - hipVelX: 0.080                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸:**
- à¹à¸ªà¸”à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ debug à¸‚à¸­à¸‡**à¸—à¸¸à¸à¸à¸**à¸—à¸µà¹ˆà¸–à¸¹à¸à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ à¹„à¸¡à¹ˆà¸‚à¸¶à¹‰à¸™à¸à¸±à¸šà¸§à¹ˆà¸²à¹€à¸¥à¸·à¸­à¸à¸£à¸°à¸”à¸±à¸šà¹„à¸«à¸™
- **FPS**: Camera Frame Rate (~30 FPS)
- **AI Rate**: AI Processing Rate (à¸‚à¸¶à¹‰à¸™à¸à¸±à¸š Performance Mode: Lite ~6 FPS, Balanced ~8 FPS, Quality ~10 FPS)

---

## à¸‡.16 à¸­à¹‰à¸²à¸‡à¸­à¸´à¸‡

- MediaPipe Pose Landmarks: [mediapipe.dev](https://mediapipe.dev)
- Chen Taijiquan Silk Reeling Principles (é™ˆå¼å¤ªææ‹³ç¼ ä¸åŠŸ)
- TaijiFlow AI Heuristics Engine v3.0

---

*Document Version: 3.0*
*Last Updated: 2026-01-15*
