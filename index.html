<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TaijiFlow AI</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png" />

    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />

    <!-- Scripts (‡πÉ‡∏ä‡πâ defer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏° HTML ‡πÅ‡∏ï‡πà‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á) -->
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"
      crossorigin="anonymous"
      defer
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/vision_bundle.js"
      crossorigin="anonymous"
      defer
    ></script>

    <!-- App Modules -->
    <script src="calibration_manager.js" defer></script>
    <script src="heuristics_engine.js" defer></script>
    <script src="drawing_manager.js" defer></script>
    <script src="data_exporter.js" defer></script>
    <script src="audio_manager.js" defer></script>
    <script src="scoring_manager.js" defer></script>
    <script src="ui_manager.js" defer></script>
    <script src="script.js" defer></script>
  </head>
  <body
    class="h-screen flex flex-col items-center justify-center p-4 bg-f3f4f6"
  >
    <!-- Header & Toggle Buttons -->
    <div class="w-full max-w-6xl flex justify-between items-center mb-4">
      <h1
        id="app-title"
        class="text-3xl font-bold text-gray-800 dark:text-white"
      >
        ‚òØÔ∏è TaijiFlow AI: ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏ù‡∏∂‡∏Å‡∏°‡∏ß‡∏¢‡πÑ‡∏ó‡πâ‡πÄ‡∏Å‡πä‡∏Å - ‡∏ó‡πà‡∏≤‡∏°‡πâ‡∏ß‡∏ô‡πÑ‡∏´‡∏°
      </h1>

      <div class="flex gap-2">
        <button
          id="audio-btn"
          class="px-3 py-1 bg-green-600 text-white border border-green-700 rounded hover:bg-green-700 text-sm transition-colors"
          title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏û‡∏π‡∏î"
        >
          üîä
        </button>
        <button
          id="lang-btn"
          class="px-3 py-1 bg-white border border-gray-300 rounded hover:bg-gray-100 font-bold text-sm transition-colors"
        >
          üáπüá≠ TH / üá∫üá∏ EN
        </button>
        <button
          id="theme-btn"
          class="px-3 py-1 bg-gray-800 text-white border border-gray-600 rounded hover:bg-gray-700 text-sm transition-colors"
        >
          üåô / ‚òÄÔ∏è
        </button>
      </div>
    </div>

    <div class="flex flex-col md:flex-row gap-6 items-start w-full max-w-6xl">
      <!-- Video Canvas Container -->
      <div class="relative flex-grow group w-full md:w-auto">
        <video
          id="input_video"
          style="display: none"
          autoplay
          playsinline
        ></video>
        <canvas
          id="output_canvas"
          width="1280"
          height="720"
          class="w-full bg-black rounded-lg"
        ></canvas>

        <!-- Loading Overlay -->
        <div
          id="loading-overlay"
          class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-80 text-white text-xl z-20 hidden rounded-lg"
        >
          <div class="flex flex-col items-center">
            <svg
              class="animate-spin h-10 w-10 text-white mb-3"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
            >
              <circle
                class="opacity-25"
                cx="12"
                cy="12"
                r="10"
                stroke="currentColor"
                stroke-width="4"
              ></circle>
              <path
                class="opacity-75"
                fill="currentColor"
                d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
              ></path>
            </svg>
            <span id="loading-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏• AI...</span>
          </div>
        </div>

        <!-- Start Overlay (‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô) -->
        <div
          id="start-overlay"
          class="absolute inset-0 flex flex-col items-center justify-center bg-black bg-opacity-70 z-10 rounded-lg transition-opacity duration-300 p-8"
        >
          <h2
            id="overlay-title"
            class="text-white text-2xl font-bold mb-6 drop-shadow-md"
          >
            üìã ‡∏ß‡∏¥‡∏ò‡∏µ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
          </h2>
          <div class="text-white text-lg text-left space-y-3 max-w-md">
            <p class="flex items-center gap-3">
              <span
                class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold"
                >1</span
              >
              <span id="overlay-step1"
                >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å"</strong> ‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡∏ß‡∏≤</span
              >
            </p>
            <p class="flex items-center gap-3">
              <span
                class="bg-blue-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold"
                >2</span
              >
              <span id="overlay-step2"
                >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å <strong>"‡∏£‡∏∞‡∏î‡∏±‡∏ö"</strong> ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å</span
              >
            </p>
            <p class="flex items-center gap-3">
              <span
                class="bg-green-600 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold"
                >3</span
              >
              <span id="overlay-step3"
                >‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° <strong>"üèÉ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å"</strong></span
              >
            </p>
          </div>
          <p id="overlay-note" class="text-gray-400 mt-6 text-sm text-center">
            ‚è±Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 5 ‡∏ô‡∏≤‡∏ó‡∏µ | üìè
            ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏à‡∏∞‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢
          </p>
        </div>

        <!-- Countdown Overlay (3-2-1) -->
        <div
          id="countdown-overlay"
          class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-80 z-30 hidden rounded-lg"
        >
          <span
            id="countdown-number"
            class="text-white text-9xl font-bold animate-pulse"
            >3</span
          >
        </div>

        <!-- Training Timer (‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ù‡∏∂‡∏Å - ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏•‡πà‡∏≤‡∏á) -->
        <div
          id="training-controls"
          class="absolute bottom-4 left-4 z-20 hidden"
        >
          <div
            class="flex items-center gap-2 bg-black bg-opacity-70 px-3 py-2 rounded-full"
          >
            <span class="text-white font-bold">‚è±Ô∏è</span>
            <span id="training-timer" class="text-white font-bold">5:00</span>
          </div>
        </div>

        <!-- Fullscreen Button (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á - ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ù‡∏∂‡∏Å) -->
        <div
          id="fullscreen-overlay-btn"
          class="absolute bottom-4 right-4 z-20 hidden"
        >
          <button
            id="video-fullscreen-btn"
            class="flex items-center gap-2 bg-black bg-opacity-70 px-3 py-2 rounded-full text-white font-bold hover:bg-opacity-90 transition"
            title="‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠"
          >
            ‚õ∂ <span id="fullscreen-btn-text">‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠</span>
          </button>
        </div>
      </div>

      <!-- Controls Panel -->
      <div
        id="main-card"
        class="w-full md:w-80 flex flex-col gap-4 bg-white p-6 rounded-lg shadow-md border border-gray-200 transition-colors duration-300"
      >
        <!-- Select Exercise -->
        <div>
          <label
            id="label-exercise"
            class="block text-sm font-bold text-gray-700 mb-2"
            >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å:</label
          >
          <select
            id="exercise-select"
            class="w-full p-2 border rounded-md bg-gray-50 text-gray-900 focus:ring-2 focus:ring-blue-500 outline-none transition-colors"
            title="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å"
          >
            <option value="" disabled selected>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å --</option>
            <option value="rh_cw">‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ - ‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°</option>
            <option value="rh_ccw">‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ - ‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°</option>
            <option value="lh_cw">‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢ - ‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°</option>
            <option value="lh_ccw">‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢ - ‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°</option>
          </select>
        </div>

        <!-- Select Level -->
        <div>
          <label
            id="label-level"
            class="block text-sm font-bold text-gray-700 mb-2"
            >‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö:</label
          >
          <div class="flex flex-col gap-2" id="level-buttons">
            <button
              id="level1-btn"
              data-level="L1"
              class="level-btn w-full py-2 px-4 rounded bg-gray-100 text-gray-600 font-medium transition hover:bg-gray-200"
            >
              Level 1: ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πà‡∏á
            </button>
            <button
              id="level2-btn"
              data-level="L2"
              class="level-btn w-full py-2 px-4 rounded bg-gray-100 text-gray-600 font-medium transition hover:bg-gray-200"
            >
              Level 2: ‡∏ó‡πà‡∏≤‡∏¢‡∏∑‡∏ô
            </button>
            <button
              id="level3-btn"
              data-level="L3"
              class="level-btn w-full py-2 px-4 rounded bg-gray-100 text-gray-600 font-medium transition hover:bg-gray-200"
            >
              Level 3: ‡∏ó‡πà‡∏≤‡∏¢‡∏∑‡∏ô‡∏¢‡πà‡∏≠
            </button>
          </div>

          <!-- Start/Stop Training Button (Toggle) -->
          <button
            id="start-training-btn"
            disabled
            class="w-full py-3 mt-2 bg-gray-400 text-white text-lg font-bold rounded-lg shadow-lg cursor-not-allowed transition"
          >
            üèÉ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å
          </button>
        </div>

        <!-- Action Buttons (‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Flow ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß) -->
        <div class="hidden">
          <div class="flex gap-2">
            <button
              id="small-calibrate-btn"
              class="flex-grow py-2 bg-purple-100 text-purple-700 font-bold rounded border border-purple-200 hover:bg-purple-200 transition"
            >
              üìè ‡∏ß‡∏±‡∏î‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡∏°‡πà
            </button>
            <button
              id="cancel-calib-btn"
              class="hidden py-2 px-4 bg-red-500 text-white font-bold rounded shadow hover:bg-red-600 transition"
            >
              ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
            </button>
          </div>

          <div class="flex gap-2">
            <button
              id="fullscreen-btn"
              class="flex-1 py-2 bg-gray-700 text-white rounded hover:bg-gray-800 transition"
            >
              ‡πÄ‡∏ï‡πá‡∏°‡∏à‡∏≠ (F)
            </button>
            <button
              id="record-btn"
              class="flex-1 py-2 bg-red-100 text-red-600 border border-red-200 rounded hover:bg-red-200 transition font-bold"
            >
              ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å (R)
            </button>
          </div>
        </div>

        <!-- Instructions (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Flow ‡πÉ‡∏´‡∏°‡πà) -->
        <div
          class="instructions-box mt-2 p-3 text-xs rounded transition-colors"
        >
          <strong id="instr-title">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong>
          <ul class="list-disc list-inside mt-1 space-y-1">
            <li id="instr-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡πà‡∏≤‡∏ù‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏î‡∏±‡∏ö ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å'</li>
            <li id="instr-2">‡∏¢‡∏∑‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏ï‡∏±‡∏ß ‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πâ‡∏≠‡∏á 2-3 ‡πÄ‡∏°‡∏ï‡∏£</li>
            <li id="instr-3">‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Notification Container -->
    <div
      id="notification-container"
      class="fixed top-5 right-5 z-50 flex flex-col items-end gap-3"
    >
      <!-- Notifications will be injected here by JavaScript -->
    </div>
  </body>
</html>
