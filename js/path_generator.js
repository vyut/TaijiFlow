/**
 * ============================================================================
 * TaijiFlow AI - Path Generator v1.0
 * ============================================================================
 *
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Dynamic Path ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å
 *
 * @description
 *   ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á Reference Path ‡πÅ‡∏ö‡∏ö Dynamic
 *   ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å‡∏à‡∏£‡∏¥‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà Fixed Path ‡∏à‡∏≤‡∏Å JSON
 *
 * üìã ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å:
 *   - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì center point ‡∏à‡∏≤‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏´‡∏•‡πà‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡πÇ‡∏û‡∏Å
 *   - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì radius ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡πÅ‡∏Ç‡∏ô
 *   - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏° 72 ‡∏à‡∏∏‡∏î (‡∏ó‡∏∏‡∏Å 5¬∞)
 *   - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á cw (‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°) ‡πÅ‡∏•‡∏∞ ccw (‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°)
 *
 * üìä ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:
 *   const path = generateDynamicPath(landmarks, 'rh_cw');
 *
 * ============================================================================
 * @author TaijiFlow AI Team
 * @since 0.6
 * @version 1.0 (2024-12-24)
 * ============================================================================
 */

/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Dynamic Path ‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏à‡∏≤‡∏Å‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏ù‡∏∂‡∏Å
 *
 * @param {Object[]} landmarks - 33 ‡∏à‡∏∏‡∏î‡∏à‡∏≤‡∏Å MediaPipe Pose
 * @param {string} exercise - ‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (rh_cw, rh_ccw, lh_cw, lh_ccw)
 * @returns {Object[]} - Array ‡∏Ç‡∏≠‡∏á‡∏à‡∏∏‡∏î {x, y} ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏á‡∏Å‡∏•‡∏°
 *
 * @example
 *   // ‡∏ó‡πà‡∏≤‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ ‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤
 *   const path = generateDynamicPath(landmarks, 'rh_cw');
 *   drawer.drawPath(path, 'rgba(0,255,0,0.5)', 4);
 */
function generateDynamicPath(landmarks, exercise) {
  // Guard: ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ landmarks ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 25 ‡∏à‡∏∏‡∏î
  if (!landmarks || landmarks.length < 25) return [];

  // 1. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤‡∏ï‡∏≤‡∏°‡∏ó‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
  const isRightHand = exercise.startsWith("rh");
  const shoulder = isRightHand ? landmarks[12] : landmarks[11];
  const hip = isRightHand ? landmarks[24] : landmarks[23];
  const wrist = isRightHand ? landmarks[16] : landmarks[15];

  // 2. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì center (‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏∞‡πÇ‡∏û‡∏Å-‡∏ó‡πâ‡∏≠‡∏á)
  //    - X: ‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡∏´‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ (‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤ = ‡∏Ç‡∏ß‡∏≤, ‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢ = ‡∏ã‡πâ‡∏≤‡∏¢)
  //    - Y: ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡∏Å‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà (60% ‡∏•‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏•‡πà = ‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏∞‡πÇ‡∏û‡∏Å)
  const shoulderWidth = Math.abs(landmarks[12].x - landmarks[11].x);
  // X: ‡πÑ‡∏´‡∏•‡πà + offset ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏ô‡∏≠‡∏Å (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 70% ‡πÉ‡∏´‡πâ‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô)
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏™‡∏•‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡πÄ‡∏û‡∏£‡∏≤‡∏∞ Canvas ‡∏ñ‡∏π‡∏Å Mirror (-1, 1) ‡πÉ‡∏ô script.js
  const sideOffset = shoulderWidth * 0.7; // 70% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏•‡πà
  const centerX = isRightHand
    ? shoulder.x - sideOffset // ‡∏°‡∏∑‡∏≠‡∏Ç‡∏ß‡∏≤: landmark ‡∏≠‡∏¢‡∏π‡πà‡∏ã‡πâ‡∏≤‡∏¢ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ mirror) ‚Üí ‡∏•‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô‡∏à‡∏≠
    : shoulder.x + sideOffset; // ‡∏°‡∏∑‡∏≠‡∏ã‡πâ‡∏≤‡∏¢: landmark ‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏ß‡∏≤ (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ mirror) ‚Üí ‡∏ö‡∏ß‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡∏à‡∏≠
  // Y: ‡∏•‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏•‡πà 40% ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏´‡∏•‡πà-‡∏™‡∏∞‡πÇ‡∏û‡∏Å (‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏´‡∏•‡πà‡∏Å‡∏±‡∏ö‡∏™‡∏∞‡πÇ‡∏û‡∏Å)
  const centerY = shoulder.y + (hip.y - shoulder.y) * 0.4;

  // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì radius ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏à‡∏≤‡∏Å‡πÑ‡∏´‡∏•‡πà‡∏ñ‡∏∂‡∏á‡∏™‡∏∞‡πÇ‡∏û‡∏Å (~45% ‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏´‡∏•‡πà-‡∏™‡∏∞‡πÇ‡∏û‡∏Å)
  const torsoHeight = Math.abs(hip.y - shoulder.y);
  const radius = torsoHeight * 0.45;

  // 4. Generate circle points (72 ‡∏à‡∏∏‡∏î, ‡∏ó‡∏∏‡∏Å 5¬∞)
  const points = [];
  const numPoints = 72;
  const direction = exercise.includes("cw") ? 1 : -1; // cw = ‡∏ï‡∏≤‡∏°‡πÄ‡∏Ç‡πá‡∏°, ccw = ‡∏ó‡∏ß‡∏ô‡πÄ‡∏Ç‡πá‡∏°

  for (let i = 0; i < numPoints; i++) {
    const angle = (i * 5 * direction * Math.PI) / 180;
    points.push({
      x: centerX + radius * Math.cos(angle),
      y: centerY + radius * Math.sin(angle),
    });
  }

  console.log(
    `[DynamicPath] Generated ${points.length} points, ` +
      `center=(${centerX.toFixed(2)}, ${centerY.toFixed(2)}), ` +
      `radius=${radius.toFixed(2)}`
  );

  return points;
}

// =============================================================================
// EXPORT (for testing)
// =============================================================================
if (typeof module !== "undefined" && module.exports) {
  module.exports = { generateDynamicPath };
}
